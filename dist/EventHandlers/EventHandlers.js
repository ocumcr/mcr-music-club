"use strict";import{Sound as e}from"../Sound.js";import{AppState as s}from"../AppState.js";import{PlaylistManager as a}from"../PlaylistManager.js";import{safeSendPlayCount as l}from"../playMusic.js";import{Navigation as c}from"../Navigation.js";import{Footer as o}from"../UI/Footer.js";import{Content as n}from"../UI/Content.js";import{LocalStorage as d}from"../LocalStorage.js";import{FooterEvents as u}from"./FooterEvents.js";export class EventHandlers{static#t=!1;static init(){if(this.#t)throw new Error("\u3059\u3067\u306Binitialized!");this.#a(),this.#r(),this.#t=!0}static togglePlayback(){e.isPlaying()?(e.pause(),o.updatePlayButtonUI(!1)):(e.play(),o.updatePlayButtonUI(!0)),n.updatePlayingClass(a.currentTrackIndex)}static async handleBack(){if(e.currentTime>.5){e.currentTime=0;return}const{track:t,index:r}=a.getPreviousTrack();await this.changeTrack(t,r)}static async handleForward(){const t=a.playlist.length-1===a.currentTrackIndex;t&&s.shuffleMode===0&&n.scrollTo(-1),t&&s.shuffleMode===1&&(a.shufflePlaylist({moveCurrentTrackToTop:!1}),n.renderPlaylist(a.playlist),n.updatePlayingClass(a.currentTrackIndex),n.scrollTo(a.currentTrackIndex));const{track:r,index:i}=a.getNextTrack();await this.changeTrack(r,i)}static async changeTrack(t,r){await e.load(t.path,s.loopMode===2),e.setVolume(d.volume),e.play(),u.setupSeekBarUpdate(e.audio),this.#e(e.audio);const i=e.getDuration();o.updateTrackInfo(t),o.updatePlayButtonUI(!0),o.updateSeekBarMax(i),o.updateDurationText(i),n.updatePlayingClass(r),c.setNavigationMenu(t),a.currentTrackIndex=r,l(t.title)}static#e(t){t.onended=()=>{if(s.loopMode===1)this.handleForward();else if(s.loopMode===0){const{track:r,index:i}=a.getNextTrack();i===0?o.updatePlayButtonUI(!1):this.changeTrack(r,i)}}}static#a(){window.addEventListener("keydown",t=>{t.code==="Space"&&(t.preventDefault(),this.togglePlayback())})}static#r(){}}
