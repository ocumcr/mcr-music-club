"use strict";import{Sound as a}from"../Sound.js";import{PlaylistManager as e}from"../PlaylistManager.js";import{Navigation as l}from"../Navigation.js";import{Footer as i}from"../UI/Footer.js";import{Content as o}from"../UI/Content.js";import{LocalStorage as s}from"../LocalStorage.js";import{FooterEvents as d}from"./FooterEvents.js";import{Survey as c}from"../Survey.js";export class EventHandlers{static#t=!1;static init(){if(this.#t)throw new Error("\u3059\u3067\u306Binitialized!");this.#e(),this.#r(),this.#t=!0}static togglePlayback(){a.isReady()&&(a.isPlaying()?(a.pause(),i.updatePlayButtonUI(!1),o.updatePlayingClass(-1)):(a.play(),i.updatePlayButtonUI(!0),o.updatePlayingClass(e.currentTrackIndex)))}static async handleBack(){if(a.currentTime>.5){a.currentTime=0;return}const{track:t,index:r}=e.getPreviousTrack();await this.changeTrack(t,r),o.scrollTo(e.currentTrackIndex)}static async handleForward({scroll:t=!0}={}){const{track:r,index:n}=e.getNextTrack();await this.changeTrack(r,n),t&&o.scrollTo(e.currentTrackIndex)}static async changeTrack(t,r){await a.load(t.path,s.loopMode===2),a.setVolume(s.volume/100),a.play(),d.setupSeekBarUpdate(a.audio),this.#a(a.audio);const n=a.getDuration();i.updateTrackInfo(t),i.updatePlayButtonUI(!0),i.updateSeekBarMax(n),i.updateDurationText(n),o.updatePlayingClass(r),l.setNavigationMenu(t),e.currentTrackIndex=r,c.safeSendPlayCount(t.title)}static#a(t){t.onended=()=>{if(s.loopMode===1)this.handleForward({scroll:!1});else if(s.loopMode===0){if(e.playlist.length-1===e.currentTrackIndex){i.updatePlayButtonUI(!1),o.updatePlayingClass(-1);return}this.handleForward({scroll:!1})}}}static#e(){window.addEventListener("keydown",t=>{t.code==="Space"&&(t.preventDefault(),this.togglePlayback())})}static#r(){}}
