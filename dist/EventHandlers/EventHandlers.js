"use strict";import{Sound as e}from"../Sound.js";import{PlaylistManager as r}from"../PlaylistManager.js";import{Navigation as l}from"../Navigation.js";import{Footer as i}from"../UI/Footer.js";import{Content as n}from"../UI/Content.js";import{LocalStorage as s}from"../LocalStorage.js";import{FooterEvents as c}from"./FooterEvents.js";import{Survey as d}from"../Survey.js";export class EventHandlers{static#t=!1;static init(){if(this.#t)throw new Error("\u3059\u3067\u306Binitialized!");this.#a(),this.#r(),this.#t=!0}static togglePlayback(){r.isAvailable()&&(e.isPlaying()?(e.pause(),i.updatePlayButtonUI(!1)):(e.play(),i.updatePlayButtonUI(!0)),n.updatePlayingClass(r.currentTrackIndex))}static async handleBack(){if(e.currentTime>.5){e.currentTime=0;return}const{track:t,index:a}=r.getPreviousTrack();await this.changeTrack(t,a),n.scrollTo(r.currentTrackIndex-1)}static async handleForward(){const{track:t,index:a}=r.getNextTrack();await this.changeTrack(t,a),n.scrollTo(r.currentTrackIndex-1)}static async changeTrack(t,a){await e.load(t.path,s.loopMode===2),e.setVolume(s.volume/100),e.play(),c.setupSeekBarUpdate(e.audio),this.#e(e.audio);const o=e.getDuration();i.updateTrackInfo(t),i.updatePlayButtonUI(!0),i.updateSeekBarMax(o),i.updateDurationText(o),n.updatePlayingClass(a),l.setNavigationMenu(t),r.currentTrackIndex=a,d.safeSendPlayCount(t.title)}static#e(t){t.onended=()=>{if(s.loopMode===1)this.handleForward();else if(s.loopMode===0){const{track:a,index:o}=r.getNextTrack();o===0?i.updatePlayButtonUI(!1):this.changeTrack(a,o)}}}static#a(){window.addEventListener("keydown",t=>{t.code==="Space"&&(t.preventDefault(),this.togglePlayback())})}static#r(){}}
