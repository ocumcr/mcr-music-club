{"version":3,"file":"run.js","sources":["../src/Sound.ts","../src/PlaylistManager.ts","../src/Record.ts","../src/LocalStorage.ts","../src/UI/Header.ts","../src/URLManager.ts","../src/EventHandlers/ContentEvents.ts","../src/UI/Content.ts","../src/Navigation.ts","../src/UI/Footer.ts","../src/Survey.ts","../src/EventHandlers/FooterEvents.ts","../src/EventHandlers/EventHandlers.ts","../src/EventHandlers/HeaderEvents.ts","../src/run.ts"],"sourcesContent":["export class Sound {\r\n    static #isReady = false\r\n\r\n    static audio: HTMLAudioElement | null = null\r\n\r\n    static #source: MediaElementAudioSourceNode\r\n    static #context: AudioContext\r\n    static #gain: GainNode\r\n\r\n    static load(src: string, loop: boolean) {\r\n        if (!this.#context) {\r\n            this.#context = new AudioContext()\r\n            this.#gain = this.#context.createGain()\r\n            this.#gain.connect(this.#context.destination)\r\n        }\r\n\r\n        if (this.audio) {\r\n            this.audio.pause()\r\n            this.#source.disconnect()\r\n        }\r\n\r\n        this.audio = new Audio(src)\r\n        this.audio.loop = loop\r\n        this.#source = this.#context.createMediaElementSource(this.audio)\r\n        this.#source.connect(this.#gain)\r\n\r\n        return new Promise<void>((resolve) => {\r\n            this.audio!.onloadedmetadata = (e) => {\r\n                this.#isReady = true\r\n\r\n                resolve()\r\n            }\r\n        })\r\n    }\r\n\r\n    static play() {\r\n        if (!this.isReady()) return\r\n        this.audio.play()\r\n    }\r\n\r\n    static pause() {\r\n        if (!this.isReady()) return\r\n        this.audio.pause()\r\n    }\r\n\r\n    static isPlaying(): boolean {\r\n        return this.isReady() && !this.audio.paused\r\n    }\r\n\r\n    static setLoop(loop: boolean) {\r\n        if (!this.isReady()) return\r\n        this.audio.loop = loop\r\n    }\r\n\r\n    static isReady(): this is typeof Sound & { audio: HTMLAudioElement } {\r\n        return this.#isReady\r\n    }\r\n\r\n    static setVolume(volume: number) {\r\n        if (volume < 0 || 1 < volume) {\r\n            console.error(\"volume must range from 0 to 1.\")\r\n            return\r\n        }\r\n\r\n        this.#gain.gain.value = volume\r\n    }\r\n\r\n    static getDuration(): number {\r\n        return this.isReady() ? this.audio.duration : 0\r\n    }\r\n\r\n    static set currentTime(second: number) {\r\n        if (!this.isReady()) return\r\n        this.audio.currentTime = second\r\n    }\r\n\r\n    static get currentTime(): number {\r\n        return this.isReady() ? this.audio.currentTime : 0\r\n    }\r\n}\r\n","// プレイリスト管理のクラス\r\nexport class PlaylistManager {\r\n    static playlist: Readonly<Track[]> = []\r\n    static defaultOrderPlaylist: Readonly<Track[]> = []\r\n\r\n    static currentTrackIndex: number = -1\r\n\r\n    static isAvailable() {\r\n        return this.currentTrackIndex !== -1\r\n    }\r\n\r\n    static setPlaylist(playlist: readonly Track[], shuffle: boolean) {\r\n        this.defaultOrderPlaylist = playlist\r\n        this.playlist = shuffle ? this.#shuffleArray([...playlist]) : playlist\r\n    }\r\n\r\n    static setDefaultOrder() {\r\n        if (this.isAvailable()) {\r\n            const currentTrack = this.playlist[this.currentTrackIndex]\r\n\r\n            this.currentTrackIndex = this.defaultOrderPlaylist.indexOf(currentTrack)\r\n        }\r\n\r\n        this.playlist = [...this.defaultOrderPlaylist]\r\n    }\r\n\r\n    static shufflePlaylist({ moveCurrentTrackToTop }: { moveCurrentTrackToTop: boolean }) {\r\n        if (this.isAvailable()) {\r\n            const currentTrack = this.playlist[this.currentTrackIndex]\r\n\r\n            // 今再生しているトラックを一番目に持ってくる\r\n            do {\r\n                this.playlist = this.#shuffleArray([...this.playlist])\r\n            } while (moveCurrentTrackToTop && this.playlist[0] != currentTrack)\r\n\r\n            if (moveCurrentTrackToTop) {\r\n                this.currentTrackIndex = 0\r\n            }\r\n        } else {\r\n            this.playlist = this.#shuffleArray([...this.playlist])\r\n        }\r\n    }\r\n\r\n    static getCurrentTrackTitle(): string | null {\r\n        if (!this.isAvailable()) return null\r\n        return this.playlist[this.currentTrackIndex].title\r\n    }\r\n\r\n    static getNextTrack() {\r\n        if (!this.isAvailable()) return { track: this.playlist[0], index: 0 }\r\n        const nextIndex = (this.currentTrackIndex + 1) % this.playlist.length\r\n        return { track: this.playlist[nextIndex], index: nextIndex }\r\n    }\r\n\r\n    static getPreviousTrack() {\r\n        if (!this.isAvailable()) return { track: this.playlist[0], index: 0 }\r\n        const prevIndex = (this.currentTrackIndex - 1 + this.playlist.length) % this.playlist.length\r\n        return { track: this.playlist[prevIndex], index: prevIndex }\r\n    }\r\n\r\n    static #shuffleArray(array: any[]) {\r\n        if (array.length == 1) return [...array]\r\n\r\n        return [...array].reduce((_, cur, idx, arr) => {\r\n            const rand = Math.floor(Math.random() * (idx + 1))\r\n            ;[arr[idx], arr[rand]] = [arr[rand], cur]\r\n            return arr\r\n        })\r\n    }\r\n}\r\n","// グローバル状態の管理\r\nexport class Record {\r\n    static data: Readonly<Track[]> = []\r\n    static playCountRecord: PlayCountRecord\r\n}\r\n","export class LocalStorage {\r\n    static set volume(volume: number) {\r\n        localStorage.setItem(\"volume\", \"\" + volume)\r\n    }\r\n\r\n    static get volume() {\r\n        return localStorage[\"volume\"] ? Number(localStorage[\"volume\"]) : 50\r\n    }\r\n\r\n    static set loopMode(loopMode: LoopMode) {\r\n        localStorage.setItem(\"loopMode\", \"\" + loopMode)\r\n    }\r\n\r\n    static get loopMode(): LoopMode {\r\n        return (localStorage[\"loopMode\"] ? Number(localStorage[\"loopMode\"]) : 0) as LoopMode\r\n    }\r\n\r\n    static set shuffleMode(loopMode: ShuffleMode) {\r\n        localStorage.setItem(\"shuffleMode\", \"\" + loopMode)\r\n    }\r\n\r\n    static get shuffleMode(): ShuffleMode {\r\n        return (localStorage[\"shuffleMode\"] ? Number(localStorage[\"shuffleMode\"]) : 0) as ShuffleMode\r\n    }\r\n}\r\n","export class Header {\r\n    static title: HTMLElement\r\n    static search: HTMLInputElement\r\n\r\n    static init() {\r\n        this.title = document.getElementById(\"title\")!\r\n        this.search = document.getElementById(\"search\") as HTMLInputElement\r\n    }\r\n\r\n    static setSearchBox(text: string) {\r\n        this.search.value = text\r\n    }\r\n}\r\n","import { Record } from \"./Record.js\"\r\nimport { LocalStorage } from \"./LocalStorage.js\"\r\nimport { PlaylistManager } from \"./PlaylistManager.js\"\r\nimport { Content } from \"./UI/Content.js\"\r\nimport { Header } from \"./UI/Header.js\"\r\nimport { Sound } from \"./Sound.js\"\r\n\r\nexport class URLManager {\r\n    static isDebugMode(): boolean {\r\n        const url = new URL(window.location.href)\r\n        return url.searchParams.get(\"debug\") === \"true\"\r\n    }\r\n\r\n    static search(text: string) {\r\n        if (text === \"\") {\r\n            this.#clearSearchQuery()\r\n        } else {\r\n            this.#setSearchQuery(text)\r\n        }\r\n\r\n        this.handleQueryChange()\r\n    }\r\n\r\n    static handleQueryChange() {\r\n        console.log(\"クエリパラメータが変更されました\")\r\n\r\n        Content.fadeIn()\r\n\r\n        const title = PlaylistManager.getCurrentTrackTitle()\r\n\r\n        Header.setSearchBox(\"\")\r\n\r\n        const search = this.#getSearchQuery()\r\n\r\n        let data = Record.data\r\n        if (search) {\r\n            data = Record.data.filter(\r\n                (track) => track.tags.includes(search) || track.title.includes(search) || track.author === search,\r\n            )\r\n            Header.setSearchBox(search)\r\n        }\r\n\r\n        PlaylistManager.setPlaylist(data, LocalStorage.shuffleMode === 1)\r\n        PlaylistManager.currentTrackIndex = PlaylistManager.playlist.findIndex((track) => track.title === title)\r\n        Content.renderPlaylist(PlaylistManager.playlist)\r\n\r\n        if (Sound.isPlaying()) {\r\n            Content.updatePlayingClass(PlaylistManager.currentTrackIndex)\r\n        }\r\n    }\r\n\r\n    static #getSearchQuery(): string | null {\r\n        const url = new URL(window.location.href)\r\n        return url.searchParams.get(\"search\") || null\r\n    }\r\n\r\n    static #setSearchQuery(query: string) {\r\n        const url = new URL(window.location.href)\r\n        url.searchParams.set(\"search\", query)\r\n        window.history.pushState({}, \"\", url)\r\n    }\r\n\r\n    static #clearSearchQuery() {\r\n        const url = new URL(window.location.href)\r\n        url.searchParams.delete(\"search\")\r\n        window.history.pushState({}, \"\", url)\r\n    }\r\n}\r\n\r\n// 履歴変更検知用のイベントリスナー\r\nwindow.addEventListener(\"popstate\", (event) => {\r\n    event.preventDefault() // ページ遷移をキャンセル\r\n\r\n    URLManager.handleQueryChange() // 関数実行\r\n\r\n    console.log(\"popped\")\r\n})\r\n","import { PlaylistManager } from \"../PlaylistManager.js\"\r\n\r\nimport { URLManager } from \"../URLManager.js\"\r\nimport { EventHandlers } from \"./EventHandlers.js\"\r\n\r\nexport class ContentEvents {\r\n    static #initialized = false\r\n\r\n    static init() {\r\n        if (this.#initialized) throw new Error(\"すでにinitialized!\")\r\n\r\n        this.#initialized = true\r\n    }\r\n\r\n    static setupTrackClickEvents(playlist: readonly Track[]) {\r\n        document.querySelectorAll(\".track\").forEach((track, i) => {\r\n            // アイコン\r\n            track.querySelector<HTMLDivElement>(\".img-box\")!.onclick = () => {\r\n                if (PlaylistManager.currentTrackIndex === i) {\r\n                    // 現在のトラックがクリックされた場合は再生/一時停止を切り替える\r\n                    EventHandlers.togglePlayback()\r\n                } else {\r\n                    // 別のトラックがクリックされた場合はそのトラックを再生する\r\n                    EventHandlers.changeTrack(playlist[i], i)\r\n                }\r\n            }\r\n\r\n            // 作者\r\n            track.querySelector<HTMLParagraphElement>(\".author\")!.onclick = () => {\r\n                URLManager.search(playlist[i].author)\r\n            }\r\n\r\n            // タグ\r\n            track.querySelectorAll<HTMLButtonElement>(\".tag-button\").forEach((button, j) => {\r\n                button.onclick = () => {\r\n                    URLManager.search(playlist[i].tags[j])\r\n                }\r\n            })\r\n        })\r\n    }\r\n}\r\n","import { ContentEvents } from \"../EventHandlers/ContentEvents.js\"\r\nimport { Record } from \"../Record.js\"\r\n\r\nexport class Content {\r\n    static debugLog: HTMLElement\r\n    static content: HTMLElement\r\n    static #musics: HTMLOListElement\r\n\r\n    static init() {\r\n        this.debugLog = document.getElementById(\"debug-log\")!\r\n        this.content = document.querySelector(\".content\")!\r\n        this.#musics = document.querySelector(\".musics\") as HTMLOListElement\r\n    }\r\n\r\n    static addLog(text: string) {\r\n        console.log(text)\r\n        // document.getElementById(\"debug-log\").innerHTML += navigator.mediaSession.playbackState + \"<br />\"\r\n        this.debugLog.innerHTML += text + \"<br />\"\r\n    }\r\n\r\n    static fadeIn() {\r\n        this.content.classList.remove(\"fade-in\")\r\n        requestAnimationFrame(() => {\r\n            this.content.classList.add(\"fade-in\")\r\n        })\r\n    }\r\n\r\n    static scrollTo(index: number) {\r\n        if (index <= 0) {\r\n            window.scrollTo({\r\n                top: 0,\r\n                behavior: \"smooth\",\r\n            })\r\n        } else {\r\n            const track = document.querySelectorAll(\".track\")[index - 1]\r\n\r\n            track.scrollIntoView({\r\n                behavior: \"smooth\",\r\n            })\r\n        }\r\n    }\r\n\r\n    static renderPlaylist(playlist: readonly Track[]) {\r\n        this.#musics.innerHTML = playlist.map(this.#createTrackElement).join(\"\")\r\n\r\n        ContentEvents.setupTrackClickEvents(playlist)\r\n\r\n        if (Record.playCountRecord) this.setPlayCount(playlist, Record.playCountRecord)\r\n    }\r\n\r\n    static #createTrackElement(track: Track) {\r\n        const tags = track.tags.map((tag) => `<button class=\"tag-button\">#${tag}</button>`).join(\"\")\r\n\r\n        return `\r\n            <li class=\"track\">\r\n                <div class=\"img-box\" style=\"\r\n                    background: url(${track.thumbnail});\r\n                    background-size: cover;\r\n                \">\r\n                    <i class=\"fa-solid fa-circle-play\"></i>\r\n                    <i class=\"fa-solid fa-circle-pause\"></i>\r\n                </div>\r\n                <div class=\"description\">\r\n                    <h3>${track.title}</h3>\r\n                    <p>${track.year}</p>\r\n                    <p class=\"author\">${track.author}</p>\r\n                    <p>${track.description}</p>\r\n                    <div class=\"tags\">\r\n                        ${tags}\r\n                    </div>\r\n                </div>\r\n                <div class=\"play-count\">取得中...</div>\r\n            </li>\r\n        `\r\n    }\r\n\r\n    static setPlayCount(playlist: readonly Track[], playCountRecord: PlayCountRecord) {\r\n        const list = document.querySelectorAll<HTMLElement>(\".play-count\")\r\n\r\n        playlist.forEach((obj, i) => {\r\n            list[i].innerText = \"再生回数: \" + (playCountRecord[obj.title] ?? 0)\r\n        })\r\n    }\r\n\r\n    static updatePlayingClass(index: number) {\r\n        this.#musics.querySelectorAll(\".track\").forEach((track, i) => track.classList.toggle(\"playing\", i === index))\r\n    }\r\n}\r\n","import { EventHandlers } from \"./EventHandlers/EventHandlers.js\"\r\nimport { Sound } from \"./Sound.js\"\r\nimport { Content } from \"./UI/Content.js\"\r\n\r\nexport class Navigation {\r\n    static setPositionState(audio: HTMLAudioElement) {\r\n        if (!(\"mediaSession\" in navigator)) return\r\n\r\n        navigator.mediaSession.setPositionState({\r\n            duration: audio.duration,\r\n            playbackRate: audio.playbackRate,\r\n            position: audio.currentTime,\r\n        })\r\n    }\r\n\r\n    static setNavigationMenu(track: Track) {\r\n        if (!(\"mediaSession\" in navigator)) return\r\n\r\n        navigator.mediaSession.metadata = new MediaMetadata({\r\n            title: track.title ?? \"\",\r\n            artist: track.author ?? \"\",\r\n            artwork: [{ src: track.thumbnail ?? \"\" }],\r\n        })\r\n    }\r\n\r\n    static init() {\r\n        if (!(\"mediaSession\" in navigator)) return\r\n\r\n        // 再生コントロール対応\r\n        navigator.mediaSession.setActionHandler(\"play\", (e) => {\r\n            Content.addLog(e.action)\r\n            navigator.mediaSession.playbackState = \"playing\"\r\n            EventHandlers.togglePlayback()\r\n        })\r\n\r\n        navigator.mediaSession.setActionHandler(\"pause\", (e) => {\r\n            Content.addLog(e.action)\r\n            navigator.mediaSession.playbackState = \"paused\"\r\n            EventHandlers.togglePlayback()\r\n        })\r\n\r\n        navigator.mediaSession.setActionHandler(\"nexttrack\", (e) => {\r\n            Content.addLog(e.action)\r\n            EventHandlers.handleForward()\r\n        })\r\n\r\n        navigator.mediaSession.setActionHandler(\"previoustrack\", (e) => {\r\n            Content.addLog(e.action)\r\n            EventHandlers.handleBack()\r\n        })\r\n\r\n        navigator.mediaSession.setActionHandler(\"seekto\", (e) => {\r\n            Content.addLog(e.action + \": \" + e.seekTime)\r\n\r\n            Sound.currentTime = +e.seekTime!\r\n        })\r\n\r\n        navigator.mediaSession.setActionHandler(\"seekbackward\", (e) => {\r\n            Content.addLog(e.action + \": \" + e.seekOffset)\r\n\r\n            Sound.currentTime -= +e.seekOffset!\r\n        })\r\n\r\n        navigator.mediaSession.setActionHandler(\"seekforward\", (e) => {\r\n            Content.addLog(e.action + \": \" + e.seekOffset)\r\n\r\n            Sound.currentTime += +e.seekOffset!\r\n        })\r\n    }\r\n}\r\n","export class Footer {\r\n    static elements: {\r\n        playButton: HTMLElement\r\n        seekBar: HTMLInputElement\r\n        currentTimeText: HTMLElement\r\n        durationText: HTMLElement\r\n        volumeControl: HTMLInputElement\r\n        musicTitle: HTMLElement\r\n        miniThumbnail: HTMLElement\r\n        loopButton: HTMLElement\r\n        shuffleButton: HTMLElement\r\n        backButton: HTMLElement\r\n        forwardButton: HTMLElement\r\n    }\r\n\r\n    static init(loopMode: LoopMode, shuffleMode: ShuffleMode, volume: number) {\r\n        this.elements = {\r\n            playButton: document.getElementById(\"play-button\") as HTMLElement,\r\n            seekBar: document.getElementById(\"seekBar\") as HTMLInputElement,\r\n            currentTimeText: document.getElementById(\"currentTime\") as HTMLElement,\r\n            durationText: document.getElementById(\"duration\") as HTMLElement,\r\n            volumeControl: document.getElementById(\"volume\") as HTMLInputElement,\r\n            musicTitle: document.getElementById(\"music-title\") as HTMLElement,\r\n            miniThumbnail: document.getElementById(\"mini-thumbnail\") as HTMLElement,\r\n            loopButton: document.getElementById(\"loop-button\") as HTMLElement,\r\n            shuffleButton: document.getElementById(\"shuffle-button\") as HTMLElement,\r\n            backButton: document.getElementById(\"back-button\") as HTMLElement,\r\n            forwardButton: document.getElementById(\"forward-button\") as HTMLElement,\r\n        }\r\n\r\n        this.#initializeVolume(volume)\r\n        this.updateLoopButtonUI(loopMode)\r\n        this.updateShuffleButtonUI(shuffleMode)\r\n    }\r\n\r\n    static #initializeVolume(volume: number) {\r\n        this.elements.volumeControl.value = \"\" + volume\r\n    }\r\n\r\n    static updateLoopButtonUI(loopMode: LoopMode) {\r\n        const loopStates = [\"loop-none\", \"\", \"loop-one\"]\r\n        const loopTitles = [\"ループしない\", \"ループする\", \"一曲ループ\"]\r\n\r\n        this.elements.loopButton.dataset[\"loop\"] = loopStates[loopMode]\r\n\r\n        this.elements.loopButton.title = loopTitles[loopMode]\r\n    }\r\n\r\n    static updateShuffleButtonUI(shuffleMode: ShuffleMode) {\r\n        this.elements.shuffleButton.classList.toggle(\"shuffle-off\", shuffleMode === 0)\r\n    }\r\n\r\n    static updatePlayButtonUI(isPlaying: boolean) {\r\n        this.elements.playButton.classList.toggle(\"button-playing\", isPlaying)\r\n    }\r\n\r\n    static updateTrackInfo(track: Track) {\r\n        this.elements.musicTitle.innerHTML = `${track.title}<br />${track.author}`\r\n        this.elements.miniThumbnail.style.backgroundImage = `url(${track.thumbnail})`\r\n        this.elements.miniThumbnail.style.backgroundSize = \"cover\"\r\n    }\r\n\r\n    static updateDurationText(time: number) {\r\n        this.elements.durationText.innerText = this.#formatTime(time)\r\n    }\r\n\r\n    static updateSeekBarMax(max: number) {\r\n        this.elements.seekBar.max = String(max)\r\n    }\r\n\r\n    static updateSeekBarAndCurrentTimeText(time: number) {\r\n        this.elements.currentTimeText.innerText = this.#formatTime(time)\r\n        this.elements.seekBar.value = String(time)\r\n    }\r\n\r\n    static #formatTime(seconds: number) {\r\n        const mins = Math.floor(seconds / 60)\r\n        const secs = Math.floor(seconds % 60)\r\n        return `${String(mins).padStart(2, \"0\")}:${String(secs).padStart(2, \"0\")}`\r\n    }\r\n}\r\n","import { URLManager } from \"./URLManager.js\"\r\n\r\nlet playCounted = false\r\n\r\nexport class Survey {\r\n    static safeSendPlayCount(title: string) {\r\n        if (!playCounted && !URLManager.isDebugMode()) {\r\n            this.#sendPlayCount(title)\r\n\r\n            playCounted = true\r\n\r\n            setTimeout(() => {\r\n                playCounted = false\r\n            }, 1000)\r\n        }\r\n    }\r\n\r\n    static async fetchPlayCountData() {\r\n        const response = await fetch(\r\n            \"https://script.google.com/macros/s/AKfycbw-M6WdDND050H_DboJKixnDERBEYu1X24O6JthlZkohDJMKfrELuQ5YHDpbZ8N3eOh/exec\",\r\n        ) // WebアプリURLを指定\r\n\r\n        const data = await response.json() // JSONデータとして解析\r\n\r\n        return data\r\n    }\r\n\r\n    static async #sendPlayCount(title: string) {\r\n        try {\r\n            const response = await fetch(\r\n                \"https://script.google.com/macros/s/AKfycbya_x47m1TS70IhvejTmlMscmsGtheak2MvwYuXvVMse-Ar6UDv1EqmG_aQTSmDxRWc/exec\",\r\n                {\r\n                    method: \"POST\",\r\n                    headers: { \"Content-Type\": \"application/json\" },\r\n                    body: JSON.stringify({\r\n                        title: title,\r\n                    }),\r\n                    mode: \"no-cors\",\r\n                },\r\n            )\r\n\r\n            // console.log(response)\r\n\r\n            if (!response.ok) {\r\n                throw new Error(`HTTP error! status: ${response.status}`)\r\n            }\r\n\r\n            const result = await response.json()\r\n            console.log(result.status === \"success\" ? \"送信完了！\" : \"エラーが発生しました。\")\r\n        } catch (error) {\r\n            console.error(\"Error:\", error)\r\n            console.log(\"送信中にエラーが発生しました。\")\r\n        }\r\n    }\r\n}\r\n","import { LocalStorage } from \"../LocalStorage.js\"\r\nimport { Navigation } from \"../Navigation.js\"\r\nimport { PlaylistManager } from \"../PlaylistManager.js\"\r\nimport { Sound } from \"../Sound.js\"\r\n\r\nimport { Content } from \"../UI/Content.js\"\r\nimport { Footer } from \"../UI/Footer.js\"\r\n\r\nimport { EventHandlers } from \"./EventHandlers.js\"\r\nimport { Survey } from \"../Survey.js\"\r\n\r\nexport class FooterEvents {\r\n    static #initialized = false\r\n\r\n    static init() {\r\n        if (this.#initialized) throw new Error(\"すでにinitialized!\")\r\n\r\n        this.#setupPlaybackControls()\r\n        this.#setupSeekBarControls()\r\n        this.#setupVolumeControls()\r\n        this.#setupLoopControls()\r\n        this.#setupShuffleControls()\r\n        this.#setupMiniThumbnail()\r\n\r\n        this.#initialized = true\r\n    }\r\n\r\n    static setupSeekBarUpdate(audio: HTMLAudioElement) {\r\n        // 再生中にシークバーを更新\r\n        audio.ontimeupdate = () => {\r\n            Footer.updateSeekBarAndCurrentTimeText(audio.currentTime)\r\n\r\n            Navigation.setPositionState(audio)\r\n\r\n            // ループ再生を検知\r\n            if (LocalStorage.loopMode == 2 && audio.duration - audio.currentTime < 0.65) {\r\n                const title = PlaylistManager.getCurrentTrackTitle()\r\n                title && Survey.safeSendPlayCount(title)\r\n            }\r\n        }\r\n    }\r\n\r\n    static #setupMiniThumbnail() {\r\n        Footer.elements.musicTitle.addEventListener(\"click\", () => {\r\n            Content.scrollTo(PlaylistManager.currentTrackIndex)\r\n        })\r\n    }\r\n\r\n    static #setupPlaybackControls() {\r\n        Footer.elements.playButton.onclick = () => EventHandlers.togglePlayback()\r\n        Footer.elements.backButton.onclick = () => EventHandlers.handleBack()\r\n        Footer.elements.forwardButton.onclick = () => EventHandlers.handleForward()\r\n    }\r\n\r\n    static #setupSeekBarControls() {\r\n        Footer.elements.seekBar.oninput = () => {\r\n            Sound.currentTime = +Footer.elements.seekBar.value\r\n        }\r\n    }\r\n\r\n    static #setupVolumeControls() {\r\n        Footer.elements.volumeControl.oninput = (e) => {\r\n            LocalStorage.volume = +(e.target as HTMLInputElement).value\r\n            Sound.setVolume(LocalStorage.volume / 100)\r\n        }\r\n    }\r\n\r\n    static #setupLoopControls() {\r\n        Footer.elements.loopButton.onclick = () => {\r\n            LocalStorage.loopMode = ((LocalStorage.loopMode + 1) % 3) as LoopMode\r\n\r\n            LocalStorage.loopMode = LocalStorage.loopMode\r\n\r\n            Footer.updateLoopButtonUI(LocalStorage.loopMode)\r\n\r\n            Sound.setLoop(LocalStorage.loopMode === 2)\r\n        }\r\n    }\r\n\r\n    static #setupShuffleControls() {\r\n        Footer.elements.shuffleButton.onclick = () => {\r\n            LocalStorage.shuffleMode = (1 - LocalStorage.shuffleMode) as ShuffleMode\r\n\r\n            LocalStorage.shuffleMode = LocalStorage.shuffleMode\r\n\r\n            Footer.updateShuffleButtonUI(LocalStorage.shuffleMode)\r\n\r\n            if (LocalStorage.shuffleMode === 1) {\r\n                PlaylistManager.shufflePlaylist({\r\n                    moveCurrentTrackToTop: true,\r\n                })\r\n            } else {\r\n                PlaylistManager.setDefaultOrder()\r\n            }\r\n\r\n            Content.renderPlaylist(PlaylistManager.playlist)\r\n            Content.updatePlayingClass(PlaylistManager.currentTrackIndex)\r\n            Content.scrollTo(PlaylistManager.currentTrackIndex)\r\n        }\r\n    }\r\n}\r\n","import { Sound } from \"../Sound.js\"\r\nimport { PlaylistManager } from \"../PlaylistManager.js\"\r\nimport { Navigation } from \"../Navigation.js\"\r\n\r\nimport { Footer } from \"../UI/Footer.js\"\r\nimport { Content } from \"../UI/Content.js\"\r\nimport { LocalStorage } from \"../LocalStorage.js\"\r\nimport { FooterEvents } from \"./FooterEvents.js\"\r\nimport { Survey } from \"../Survey.js\"\r\n\r\n// イベントハンドラの設定\r\nexport class EventHandlers {\r\n    static #initialized = false\r\n\r\n    static init() {\r\n        if (this.#initialized) throw new Error(\"すでにinitialized!\")\r\n\r\n        this.#setupKeyboardControls()\r\n        this.#setupVisibilityHandler()\r\n\r\n        this.#initialized = true\r\n    }\r\n\r\n    static togglePlayback() {\r\n        if (!Sound.isReady()) return\r\n\r\n        if (Sound.isPlaying()) {\r\n            Sound.pause()\r\n            Footer.updatePlayButtonUI(false)\r\n            Content.updatePlayingClass(-1)\r\n        } else {\r\n            Sound.play()\r\n            Footer.updatePlayButtonUI(true)\r\n            Content.updatePlayingClass(PlaylistManager.currentTrackIndex)\r\n        }\r\n    }\r\n\r\n    static async handleBack() {\r\n        if (Sound.currentTime > 0.5) {\r\n            Sound.currentTime = 0\r\n            return\r\n        }\r\n\r\n        const { track, index } = PlaylistManager.getPreviousTrack()\r\n        await this.changeTrack(track, index)\r\n        Content.scrollTo(PlaylistManager.currentTrackIndex)\r\n    }\r\n\r\n    static async handleForward({ scroll = true } = {}) {\r\n        const { track, index } = PlaylistManager.getNextTrack()\r\n        await this.changeTrack(track, index)\r\n        scroll && Content.scrollTo(PlaylistManager.currentTrackIndex)\r\n    }\r\n\r\n    static async changeTrack(track: Track, index: number) {\r\n        await Sound.load(track.path, LocalStorage.loopMode === 2)\r\n        Sound.setVolume(LocalStorage.volume / 100)\r\n        Sound.play()\r\n\r\n        FooterEvents.setupSeekBarUpdate(Sound.audio!)\r\n        this.#setupTrackEnded(Sound.audio!)\r\n\r\n        const duration = Sound.getDuration()\r\n\r\n        Footer.updateTrackInfo(track)\r\n        Footer.updatePlayButtonUI(true)\r\n        Footer.updateSeekBarMax(duration)\r\n        Footer.updateDurationText(duration)\r\n        Content.updatePlayingClass(index)\r\n\r\n        Navigation.setNavigationMenu(track)\r\n\r\n        PlaylistManager.currentTrackIndex = index\r\n\r\n        Survey.safeSendPlayCount(track.title)\r\n    }\r\n\r\n    static #setupTrackEnded(audio: HTMLAudioElement) {\r\n        audio.onended = () => {\r\n            if (LocalStorage.loopMode === 1) {\r\n                this.handleForward({ scroll: false })\r\n                //\r\n            } else if (LocalStorage.loopMode === 0) {\r\n                const isLast = PlaylistManager.playlist.length - 1 === PlaylistManager.currentTrackIndex\r\n\r\n                if (isLast) {\r\n                    // 止める\r\n                    Footer.updatePlayButtonUI(false)\r\n                    Content.updatePlayingClass(-1)\r\n                    return\r\n                }\r\n\r\n                this.handleForward({ scroll: false })\r\n            }\r\n        }\r\n    }\r\n\r\n    static #setupKeyboardControls() {\r\n        window.addEventListener(\"keydown\", (e) => {\r\n            if (e.code === \"Space\") {\r\n                e.preventDefault()\r\n                this.togglePlayback()\r\n            }\r\n        })\r\n    }\r\n\r\n    static #setupVisibilityHandler() {\r\n        // document.addEventListener(\"visibilitychange\", async (e) => {\r\n        //     addLog(\"visibility changed: \" + document.visibilityState)\r\n        //     addLog(\"OS: \" + getMobileOS())\r\n        //     if (getMobileOS() != \"iOS\") return\r\n        //     if (document.visibilityState === \"visible\") {\r\n        //         if (PlayerState.wasPlaying) {\r\n        //             PlayerState.audio.play()\r\n        //         }\r\n        //         const interval = setInterval(() => {\r\n        //             addLog(PlayerState.audio.playbackRate)\r\n        //         }, 1000 / 24)\r\n        //         setTimeout(() => {\r\n        //             clearInterval(interval)\r\n        //         }, 10000)\r\n        //     } else {\r\n        //         // ページから離れる時の処理\r\n        //         PlayerState.wasPlaying = !PlayerState.audio.paused\r\n        //         PlayerState.audio.pause()\r\n        //     }\r\n        // })\r\n    }\r\n}\r\n","import { Header } from \"../UI/Header.js\"\r\nimport { URLManager } from \"../URLManager.js\"\r\n\r\nexport class HeaderEvents {\r\n    static #initialized = false\r\n\r\n    static init() {\r\n        if (this.#initialized) throw new Error(\"すでにinitialized!\")\r\n\r\n        this.#setupForm()\r\n        this.#setupTitle()\r\n\r\n        this.#initialized = true\r\n    }\r\n\r\n    static #setupForm() {\r\n        const form = document.querySelector<HTMLFormElement>(\".search\")!\r\n\r\n        form.onsubmit = (e) => {\r\n            e.preventDefault()\r\n\r\n            URLManager.search(Header.search.value)\r\n        }\r\n    }\r\n\r\n    static #setupTitle() {\r\n        Header.title.onclick = (e) => {\r\n            e.preventDefault()\r\n\r\n            URLManager.search(\"\")\r\n        }\r\n    }\r\n}\r\n","import { EventHandlers } from \"./EventHandlers/EventHandlers.js\"\r\nimport { ContentEvents } from \"./EventHandlers/ContentEvents.js\"\r\nimport { HeaderEvents } from \"./EventHandlers/HeaderEvents.js\"\r\nimport { FooterEvents } from \"./EventHandlers/FooterEvents.js\"\r\n\r\nimport { Record } from \"./Record.js\"\r\nimport { Survey } from \"./Survey.js\"\r\nimport { PlaylistManager } from \"./PlaylistManager.js\"\r\nimport { Navigation } from \"./Navigation.js\"\r\nimport { LocalStorage } from \"./LocalStorage.js\"\r\nimport { URLManager } from \"./URLManager.js\"\r\n\r\nimport { Content } from \"./UI/Content.js\"\r\nimport { Footer } from \"./UI/Footer.js\"\r\nimport { Header } from \"./UI/Header.js\"\r\n\r\n// アプリケーションの初期化\r\nasync function initializeApp() {\r\n    Footer.init(LocalStorage.loopMode, LocalStorage.shuffleMode, LocalStorage.volume)\r\n    Header.init()\r\n    Content.init()\r\n    EventHandlers.init()\r\n    HeaderEvents.init()\r\n    FooterEvents.init()\r\n    ContentEvents.init()\r\n    Navigation.init()\r\n\r\n    const response = await fetch(\"music-data.json\")\r\n    Record.data = Object.freeze(await response.json())\r\n    PlaylistManager.setPlaylist(Record.data, LocalStorage.shuffleMode === 1)\r\n\r\n    // 初期ロード時のクエリ処理\r\n    URLManager.handleQueryChange()\r\n\r\n    if (URLManager.isDebugMode()) {\r\n        console.log(\"開けゴマ!\")\r\n        Content.debugLog.style.display = \"block\"\r\n    }\r\n\r\n    Record.playCountRecord = Object.freeze(await Survey.fetchPlayCountData())\r\n\r\n    Content.setPlayCount(PlaylistManager.playlist, Record.playCountRecord)\r\n}\r\n\r\nfunction tryInitialize() {\r\n    try {\r\n        initializeApp()\r\n    } catch (error) {\r\n        alert(error)\r\n    }\r\n}\r\n\r\nif (document.readyState === \"complete\") {\r\n    tryInitialize()\r\n} else {\r\n    document.addEventListener(\"DOMContentLoaded\", tryInitialize)\r\n}\r\n"],"names":["Sound","#isReady","#source","#context","#gain","src","loop","resolve","e","volume","second","PlaylistManager","playlist","shuffle","#shuffleArray","currentTrack","moveCurrentTrackToTop","nextIndex","prevIndex","array","_","cur","idx","arr","rand","Record","LocalStorage","loopMode","Header","text","URLManager","#clearSearchQuery","#setSearchQuery","Content","title","search","#getSearchQuery","data","track","query","url","event","ContentEvents","#initialized","i","EventHandlers","button","j","#musics","index","#createTrackElement","tags","tag","playCountRecord","list","obj","Navigation","audio","Footer","shuffleMode","#initializeVolume","loopStates","loopTitles","isPlaying","time","#formatTime","max","seconds","mins","secs","playCounted","Survey","#sendPlayCount","response","result","error","FooterEvents","#setupPlaybackControls","#setupSeekBarControls","#setupVolumeControls","#setupLoopControls","#setupShuffleControls","#setupMiniThumbnail","#setupKeyboardControls","#setupVisibilityHandler","scroll","#setupTrackEnded","duration","HeaderEvents","#setupForm","#setupTitle","form","initializeApp","tryInitialize"],"mappings":"AAAO,MAAMA,CAAM,CACf,MAAOC,GAAW,GAElB,OAAO,MAAiC,KAExC,MAAOC,GACP,MAAOC,GACP,MAAOC,GAEP,OAAO,KAAKC,EAAaC,EAAe,CACpC,OAAK,KAAKH,KACN,KAAKA,GAAW,IAAI,aACpB,KAAKC,GAAQ,KAAKD,GAAS,WAAA,EAC3B,KAAKC,GAAM,QAAQ,KAAKD,GAAS,WAAW,GAG5C,KAAK,QACL,KAAK,MAAM,MAAA,EACX,KAAKD,GAAQ,WAAA,GAGjB,KAAK,MAAQ,IAAI,MAAMG,CAAG,EAC1B,KAAK,MAAM,KAAOC,EAClB,KAAKJ,GAAU,KAAKC,GAAS,yBAAyB,KAAK,KAAK,EAChE,KAAKD,GAAQ,QAAQ,KAAKE,EAAK,EAExB,IAAI,QAAeG,GAAY,CAClC,KAAK,MAAO,iBAAoBC,GAAM,CAClC,KAAKP,GAAW,GAEhBM,EAAA,CAAQ,CACZ,CACH,CAAA,CAGL,OAAO,MAAO,CACL,KAAK,WACV,KAAK,MAAM,KAAA,CAAK,CAGpB,OAAO,OAAQ,CACN,KAAK,WACV,KAAK,MAAM,MAAA,CAAM,CAGrB,OAAO,WAAqB,CACxB,OAAO,KAAK,QAAA,GAAa,CAAC,KAAK,MAAM,MAAA,CAGzC,OAAO,QAAQD,EAAe,CACrB,KAAK,YACV,KAAK,MAAM,KAAOA,EAAA,CAGtB,OAAO,SAA8D,CACjE,OAAO,KAAKL,EAAA,CAGhB,OAAO,UAAUQ,EAAgB,CAC7B,GAAIA,EAAS,GAAK,EAAIA,EAAQ,CAC1B,QAAQ,MAAM,gCAAgC,EAC9C,MAAA,CAGJ,KAAKL,GAAM,KAAK,MAAQK,CAAA,CAG5B,OAAO,aAAsB,CACzB,OAAO,KAAK,QAAA,EAAY,KAAK,MAAM,SAAW,CAAA,CAGlD,WAAW,YAAYC,EAAgB,CAC9B,KAAK,YACV,KAAK,MAAM,YAAcA,EAAA,CAG7B,WAAW,aAAsB,CAC7B,OAAO,KAAK,QAAA,EAAY,KAAK,MAAM,YAAc,CAAA,CAEzD,CC9EO,MAAMC,CAAgB,CACzB,OAAO,SAA8B,CAAA,EACrC,OAAO,qBAA0C,CAAA,EAEjD,OAAO,kBAA4B,GAEnC,OAAO,aAAc,CACjB,OAAO,KAAK,oBAAsB,EAAA,CAGtC,OAAO,YAAYC,EAA4BC,EAAkB,CAC7D,KAAK,qBAAuBD,EAC5B,KAAK,SAAWC,EAAU,KAAKC,GAAc,CAAC,GAAGF,CAAQ,CAAC,EAAIA,CAAA,CAGlE,OAAO,iBAAkB,CACrB,GAAI,KAAK,cAAe,CACpB,MAAMG,EAAe,KAAK,SAAS,KAAK,iBAAiB,EAEzD,KAAK,kBAAoB,KAAK,qBAAqB,QAAQA,CAAY,CAAA,CAG3E,KAAK,SAAW,CAAC,GAAG,KAAK,oBAAoB,CAAA,CAGjD,OAAO,gBAAgB,CAAE,sBAAAC,GAA6D,CAClF,GAAI,KAAK,cAAe,CACpB,MAAMD,EAAe,KAAK,SAAS,KAAK,iBAAiB,EAGzD,GACI,KAAK,SAAW,KAAKD,GAAc,CAAC,GAAG,KAAK,QAAQ,CAAC,QAChDE,GAAyB,KAAK,SAAS,CAAC,GAAKD,GAElDC,IACA,KAAK,kBAAoB,EAC7B,MAEA,KAAK,SAAW,KAAKF,GAAc,CAAC,GAAG,KAAK,QAAQ,CAAC,CACzD,CAGJ,OAAO,sBAAsC,CACzC,OAAK,KAAK,YAAA,EACH,KAAK,SAAS,KAAK,iBAAiB,EAAE,MADb,IACa,CAGjD,OAAO,cAAe,CAClB,GAAI,CAAC,KAAK,YAAA,EAAe,MAAO,CAAE,MAAO,KAAK,SAAS,CAAC,EAAG,MAAO,CAAA,EAClE,MAAMG,GAAa,KAAK,kBAAoB,GAAK,KAAK,SAAS,OAC/D,MAAO,CAAE,MAAO,KAAK,SAASA,CAAS,EAAG,MAAOA,CAAA,CAAU,CAG/D,OAAO,kBAAmB,CACtB,GAAI,CAAC,KAAK,YAAA,EAAe,MAAO,CAAE,MAAO,KAAK,SAAS,CAAC,EAAG,MAAO,CAAA,EAClE,MAAMC,GAAa,KAAK,kBAAoB,EAAI,KAAK,SAAS,QAAU,KAAK,SAAS,OACtF,MAAO,CAAE,MAAO,KAAK,SAASA,CAAS,EAAG,MAAOA,CAAA,CAAU,CAG/D,MAAOJ,GAAcK,EAAc,CAC/B,OAAIA,EAAM,QAAU,EAAU,CAAC,GAAGA,CAAK,EAEhC,CAAC,GAAGA,CAAK,EAAE,OAAO,CAACC,EAAGC,EAAKC,EAAKC,IAAQ,CAC3C,MAAMC,EAAO,KAAK,MAAM,KAAK,UAAYF,EAAM,EAAE,EAChD,OAACC,EAAID,CAAG,EAAGC,EAAIC,CAAI,CAAC,EAAI,CAACD,EAAIC,CAAI,EAAGH,CAAG,EACjCE,CAAA,CACV,CAAA,CAET,CCpEO,MAAME,CAAO,CAChB,OAAO,KAA0B,CAAA,EACjC,OAAO,eACX,CCJO,MAAMC,CAAa,CACtB,WAAW,OAAOjB,EAAgB,CAC9B,aAAa,QAAQ,SAAU,GAAKA,CAAM,CAAA,CAG9C,WAAW,QAAS,CAChB,OAAO,aAAa,OAAY,OAAO,aAAa,MAAS,EAAI,EAAA,CAGrE,WAAW,SAASkB,EAAoB,CACpC,aAAa,QAAQ,WAAY,GAAKA,CAAQ,CAAA,CAGlD,WAAW,UAAqB,CAC5B,OAAQ,aAAa,SAAc,OAAO,aAAa,QAAW,EAAI,CAAA,CAG1E,WAAW,YAAYA,EAAuB,CAC1C,aAAa,QAAQ,cAAe,GAAKA,CAAQ,CAAA,CAGrD,WAAW,aAA2B,CAClC,OAAQ,aAAa,YAAiB,OAAO,aAAa,WAAc,EAAI,CAAA,CAEpF,CCxBO,MAAMC,CAAO,CAChB,OAAO,MACP,OAAO,OAEP,OAAO,MAAO,CACV,KAAK,MAAQ,SAAS,eAAe,OAAO,EAC5C,KAAK,OAAS,SAAS,eAAe,QAAQ,CAAA,CAGlD,OAAO,aAAaC,EAAc,CAC9B,KAAK,OAAO,MAAQA,CAAA,CAE5B,CCLO,MAAMC,CAAW,CACpB,OAAO,aAAuB,CAE1B,OADY,IAAI,IAAI,OAAO,SAAS,IAAI,EAC7B,aAAa,IAAI,OAAO,IAAM,MAAA,CAG7C,OAAO,OAAOD,EAAc,CACpBA,IAAS,GACT,KAAKE,GAAA,EAEL,KAAKC,GAAgBH,CAAI,EAG7B,KAAK,kBAAA,CAAkB,CAG3B,OAAO,mBAAoB,CACvB,QAAQ,IAAI,kBAAkB,EAE9BI,EAAQ,OAAA,EAER,MAAMC,EAAQvB,EAAgB,qBAAA,EAE9BiB,EAAO,aAAa,EAAE,EAEtB,MAAMO,EAAS,KAAKC,GAAA,EAEpB,IAAIC,EAAOZ,EAAO,KACdU,IACAE,EAAOZ,EAAO,KAAK,OACda,GAAUA,EAAM,KAAK,SAASH,CAAM,GAAKG,EAAM,MAAM,SAASH,CAAM,GAAKG,EAAM,SAAWH,CAAA,EAE/FP,EAAO,aAAaO,CAAM,GAG9BxB,EAAgB,YAAY0B,EAAMX,EAAa,cAAgB,CAAC,EAChEf,EAAgB,kBAAoBA,EAAgB,SAAS,UAAW2B,GAAUA,EAAM,QAAUJ,CAAK,EACvGD,EAAQ,eAAetB,EAAgB,QAAQ,EAE3CX,EAAM,aACNiC,EAAQ,mBAAmBtB,EAAgB,iBAAiB,CAChE,CAGJ,MAAOyB,IAAiC,CAEpC,OADY,IAAI,IAAI,OAAO,SAAS,IAAI,EAC7B,aAAa,IAAI,QAAQ,GAAK,IAAA,CAG7C,MAAOJ,GAAgBO,EAAe,CAClC,MAAMC,EAAM,IAAI,IAAI,OAAO,SAAS,IAAI,EACxCA,EAAI,aAAa,IAAI,SAAUD,CAAK,EACpC,OAAO,QAAQ,UAAU,CAAA,EAAI,GAAIC,CAAG,CAAA,CAGxC,MAAOT,IAAoB,CACvB,MAAMS,EAAM,IAAI,IAAI,OAAO,SAAS,IAAI,EACxCA,EAAI,aAAa,OAAO,QAAQ,EAChC,OAAO,QAAQ,UAAU,CAAA,EAAI,GAAIA,CAAG,CAAA,CAE5C,CAGA,OAAO,iBAAiB,WAAaC,GAAU,CAC3CA,EAAM,eAAA,EAENX,EAAW,kBAAA,EAEX,QAAQ,IAAI,QAAQ,CACxB,CAAC,ECvEM,MAAMY,CAAc,CACvB,MAAOC,GAAe,GAEtB,OAAO,MAAO,CACV,GAAI,KAAKA,GAAc,MAAM,IAAI,MAAM,iBAAiB,EAExD,KAAKA,GAAe,EAAA,CAGxB,OAAO,sBAAsB/B,EAA4B,CACrD,SAAS,iBAAiB,QAAQ,EAAE,QAAQ,CAAC0B,EAAOM,IAAM,CAEtDN,EAAM,cAA8B,UAAU,EAAG,QAAU,IAAM,CACzD3B,EAAgB,oBAAsBiC,EAEtCC,EAAc,eAAA,EAGdA,EAAc,YAAYjC,EAASgC,CAAC,EAAGA,CAAC,CAC5C,EAIJN,EAAM,cAAoC,SAAS,EAAG,QAAU,IAAM,CAClER,EAAW,OAAOlB,EAASgC,CAAC,EAAE,MAAM,CAAA,EAIxCN,EAAM,iBAAoC,aAAa,EAAE,QAAQ,CAACQ,EAAQC,IAAM,CAC5ED,EAAO,QAAU,IAAM,CACnBhB,EAAW,OAAOlB,EAASgC,CAAC,EAAE,KAAKG,CAAC,CAAC,CAAA,CACzC,CACH,CAAA,CACJ,CAAA,CAET,CCrCO,MAAMd,CAAQ,CACjB,OAAO,SACP,OAAO,QACP,MAAOe,GAEP,OAAO,MAAO,CACV,KAAK,SAAW,SAAS,eAAe,WAAW,EACnD,KAAK,QAAU,SAAS,cAAc,UAAU,EAChD,KAAKA,GAAU,SAAS,cAAc,SAAS,CAAA,CAGnD,OAAO,OAAOnB,EAAc,CACxB,QAAQ,IAAIA,CAAI,EAEhB,KAAK,SAAS,WAAaA,EAAO,QAAA,CAGtC,OAAO,QAAS,CACZ,KAAK,QAAQ,UAAU,OAAO,SAAS,EACvC,sBAAsB,IAAM,CACxB,KAAK,QAAQ,UAAU,IAAI,SAAS,CAAA,CACvC,CAAA,CAGL,OAAO,SAASoB,EAAe,CACvBA,GAAS,EACT,OAAO,SAAS,CACZ,IAAK,EACL,SAAU,QAAA,CACb,EAEa,SAAS,iBAAiB,QAAQ,EAAEA,EAAQ,CAAC,EAErD,eAAe,CACjB,SAAU,QAAA,CACb,CACL,CAGJ,OAAO,eAAerC,EAA4B,CAC9C,KAAKoC,GAAQ,UAAYpC,EAAS,IAAI,KAAKsC,EAAmB,EAAE,KAAK,EAAE,EAEvER,EAAc,sBAAsB9B,CAAQ,EAExCa,EAAO,iBAAiB,KAAK,aAAab,EAAUa,EAAO,eAAe,CAAA,CAGlF,MAAOyB,GAAoBZ,EAAc,CACrC,MAAMa,EAAOb,EAAM,KAAK,IAAKc,GAAQ,+BAA+BA,CAAG,WAAW,EAAE,KAAK,EAAE,EAE3F,MAAO;AAAA;AAAA;AAAA,sCAGuBd,EAAM,SAAS;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,0BAO3BA,EAAM,KAAK;AAAA,yBACZA,EAAM,IAAI;AAAA,wCACKA,EAAM,MAAM;AAAA,yBAC3BA,EAAM,WAAW;AAAA;AAAA,0BAEhBa,CAAI;AAAA;AAAA;AAAA;AAAA;AAAA,SAAA,CAQ1B,OAAO,aAAavC,EAA4ByC,EAAkC,CAC9E,MAAMC,EAAO,SAAS,iBAA8B,aAAa,EAEjE1C,EAAS,QAAQ,CAAC2C,EAAKX,IAAM,CACzBU,EAAKV,CAAC,EAAE,UAAY,UAAYS,EAAgBE,EAAI,KAAK,GAAK,EAAA,CACjE,CAAA,CAGL,OAAO,mBAAmBN,EAAe,CACrC,KAAKD,GAAQ,iBAAiB,QAAQ,EAAE,QAAQ,CAACV,EAAOM,IAAMN,EAAM,UAAU,OAAO,UAAWM,IAAMK,CAAK,CAAC,CAAA,CAEpH,CCnFO,MAAMO,CAAW,CACpB,OAAO,iBAAiBC,EAAyB,CACvC,iBAAkB,WAExB,UAAU,aAAa,iBAAiB,CACpC,SAAUA,EAAM,SAChB,aAAcA,EAAM,aACpB,SAAUA,EAAM,WAAA,CACnB,CAAA,CAGL,OAAO,kBAAkBnB,EAAc,CAC7B,iBAAkB,YAExB,UAAU,aAAa,SAAW,IAAI,cAAc,CAChD,MAAOA,EAAM,OAAS,GACtB,OAAQA,EAAM,QAAU,GACxB,QAAS,CAAC,CAAE,IAAKA,EAAM,WAAa,GAAI,CAAA,CAC3C,EAAA,CAGL,OAAO,MAAO,CACJ,iBAAkB,YAGxB,UAAU,aAAa,iBAAiB,OAAS9B,GAAM,CACnDyB,EAAQ,OAAOzB,EAAE,MAAM,EACvB,UAAU,aAAa,cAAgB,UACvCqC,EAAc,eAAA,CAAe,CAChC,EAED,UAAU,aAAa,iBAAiB,QAAUrC,GAAM,CACpDyB,EAAQ,OAAOzB,EAAE,MAAM,EACvB,UAAU,aAAa,cAAgB,SACvCqC,EAAc,eAAA,CAAe,CAChC,EAED,UAAU,aAAa,iBAAiB,YAAcrC,GAAM,CACxDyB,EAAQ,OAAOzB,EAAE,MAAM,EACvBqC,EAAc,cAAA,CAAc,CAC/B,EAED,UAAU,aAAa,iBAAiB,gBAAkBrC,GAAM,CAC5DyB,EAAQ,OAAOzB,EAAE,MAAM,EACvBqC,EAAc,WAAA,CAAW,CAC5B,EAED,UAAU,aAAa,iBAAiB,SAAWrC,GAAM,CACrDyB,EAAQ,OAAOzB,EAAE,OAAS,KAAOA,EAAE,QAAQ,EAE3CR,EAAM,YAAc,CAACQ,EAAE,QAAA,CAC1B,EAED,UAAU,aAAa,iBAAiB,eAAiBA,GAAM,CAC3DyB,EAAQ,OAAOzB,EAAE,OAAS,KAAOA,EAAE,UAAU,EAE7CR,EAAM,aAAe,CAACQ,EAAE,UAAA,CAC3B,EAED,UAAU,aAAa,iBAAiB,cAAgBA,GAAM,CAC1DyB,EAAQ,OAAOzB,EAAE,OAAS,KAAOA,EAAE,UAAU,EAE7CR,EAAM,aAAe,CAACQ,EAAE,UAAA,CAC3B,EAAA,CAET,CCrEO,MAAMkD,CAAO,CAChB,OAAO,SAcP,OAAO,KAAK/B,EAAoBgC,EAA0BlD,EAAgB,CACtE,KAAK,SAAW,CACZ,WAAY,SAAS,eAAe,aAAa,EACjD,QAAS,SAAS,eAAe,SAAS,EAC1C,gBAAiB,SAAS,eAAe,aAAa,EACtD,aAAc,SAAS,eAAe,UAAU,EAChD,cAAe,SAAS,eAAe,QAAQ,EAC/C,WAAY,SAAS,eAAe,aAAa,EACjD,cAAe,SAAS,eAAe,gBAAgB,EACvD,WAAY,SAAS,eAAe,aAAa,EACjD,cAAe,SAAS,eAAe,gBAAgB,EACvD,WAAY,SAAS,eAAe,aAAa,EACjD,cAAe,SAAS,eAAe,gBAAgB,CAAA,EAG3D,KAAKmD,GAAkBnD,CAAM,EAC7B,KAAK,mBAAmBkB,CAAQ,EAChC,KAAK,sBAAsBgC,CAAW,CAAA,CAG1C,MAAOC,GAAkBnD,EAAgB,CACrC,KAAK,SAAS,cAAc,MAAQ,GAAKA,CAAA,CAG7C,OAAO,mBAAmBkB,EAAoB,CAC1C,MAAMkC,EAAa,CAAC,YAAa,GAAI,UAAU,EACzCC,EAAa,CAAC,SAAU,QAAS,OAAO,EAE9C,KAAK,SAAS,WAAW,QAAQ,KAAUD,EAAWlC,CAAQ,EAE9D,KAAK,SAAS,WAAW,MAAQmC,EAAWnC,CAAQ,CAAA,CAGxD,OAAO,sBAAsBgC,EAA0B,CACnD,KAAK,SAAS,cAAc,UAAU,OAAO,cAAeA,IAAgB,CAAC,CAAA,CAGjF,OAAO,mBAAmBI,EAAoB,CAC1C,KAAK,SAAS,WAAW,UAAU,OAAO,iBAAkBA,CAAS,CAAA,CAGzE,OAAO,gBAAgBzB,EAAc,CACjC,KAAK,SAAS,WAAW,UAAY,GAAGA,EAAM,KAAK,SAASA,EAAM,MAAM,GACxE,KAAK,SAAS,cAAc,MAAM,gBAAkB,OAAOA,EAAM,SAAS,IAC1E,KAAK,SAAS,cAAc,MAAM,eAAiB,OAAA,CAGvD,OAAO,mBAAmB0B,EAAc,CACpC,KAAK,SAAS,aAAa,UAAY,KAAKC,GAAYD,CAAI,CAAA,CAGhE,OAAO,iBAAiBE,EAAa,CACjC,KAAK,SAAS,QAAQ,IAAM,OAAOA,CAAG,CAAA,CAG1C,OAAO,gCAAgCF,EAAc,CACjD,KAAK,SAAS,gBAAgB,UAAY,KAAKC,GAAYD,CAAI,EAC/D,KAAK,SAAS,QAAQ,MAAQ,OAAOA,CAAI,CAAA,CAG7C,MAAOC,GAAYE,EAAiB,CAChC,MAAMC,EAAO,KAAK,MAAMD,EAAU,EAAE,EAC9BE,EAAO,KAAK,MAAMF,EAAU,EAAE,EACpC,MAAO,GAAG,OAAOC,CAAI,EAAE,SAAS,EAAG,GAAG,CAAC,IAAI,OAAOC,CAAI,EAAE,SAAS,EAAG,GAAG,CAAC,EAAA,CAEhF,CC9EA,IAAIC,EAAc,GAEX,MAAMC,CAAO,CAChB,OAAO,kBAAkBrC,EAAe,CAChC,CAACoC,GAAe,CAACxC,EAAW,gBAC5B,KAAK0C,GAAetC,CAAK,EAEzBoC,EAAc,GAEd,WAAW,IAAM,CACbA,EAAc,EAAA,EACf,GAAI,EACX,CAGJ,aAAa,oBAAqB,CAO9B,OAFa,MAJI,MAAM,MACnB,kHAAA,GAGwB,KAAA,CAErB,CAGX,YAAaE,GAAetC,EAAe,CACvC,GAAI,CACA,MAAMuC,EAAW,MAAM,MACnB,mHACA,CACI,OAAQ,OACR,QAAS,CAAE,eAAgB,kBAAA,EAC3B,KAAM,KAAK,UAAU,CACjB,MAAAvC,CAAA,CACH,EACD,KAAM,SAAA,CACV,EAKJ,GAAI,CAACuC,EAAS,GACV,MAAM,IAAI,MAAM,uBAAuBA,EAAS,MAAM,EAAE,EAG5D,MAAMC,EAAS,MAAMD,EAAS,KAAA,EAC9B,QAAQ,IAAIC,EAAO,SAAW,UAAY,QAAU,aAAa,CAAA,OAC5DC,EAAO,CACZ,QAAQ,MAAM,SAAUA,CAAK,EAC7B,QAAQ,IAAI,iBAAiB,CAAA,CACjC,CAER,CC3CO,MAAMC,CAAa,CACtB,MAAOjC,GAAe,GAEtB,OAAO,MAAO,CACV,GAAI,KAAKA,GAAc,MAAM,IAAI,MAAM,iBAAiB,EAExD,KAAKkC,GAAA,EACL,KAAKC,GAAA,EACL,KAAKC,GAAA,EACL,KAAKC,GAAA,EACL,KAAKC,GAAA,EACL,KAAKC,GAAA,EAEL,KAAKvC,GAAe,EAAA,CAGxB,OAAO,mBAAmBc,EAAyB,CAE/CA,EAAM,aAAe,IAAM,CAMvB,GALAC,EAAO,gCAAgCD,EAAM,WAAW,EAExDD,EAAW,iBAAiBC,CAAK,EAG7B/B,EAAa,UAAY,GAAK+B,EAAM,SAAWA,EAAM,YAAc,IAAM,CACzE,MAAMvB,EAAQvB,EAAgB,qBAAA,EAC9BuB,GAASqC,EAAO,kBAAkBrC,CAAK,CAAA,CAC3C,CACJ,CAGJ,MAAOgD,IAAsB,CACzBxB,EAAO,SAAS,WAAW,iBAAiB,QAAS,IAAM,CACvDzB,EAAQ,SAAStB,EAAgB,iBAAiB,CAAA,CACrD,CAAA,CAGL,MAAOkE,IAAyB,CAC5BnB,EAAO,SAAS,WAAW,QAAU,IAAMb,EAAc,eAAA,EACzDa,EAAO,SAAS,WAAW,QAAU,IAAMb,EAAc,WAAA,EACzDa,EAAO,SAAS,cAAc,QAAU,IAAMb,EAAc,cAAA,CAAc,CAG9E,MAAOiC,IAAwB,CAC3BpB,EAAO,SAAS,QAAQ,QAAU,IAAM,CACpC1D,EAAM,YAAc,CAAC0D,EAAO,SAAS,QAAQ,KAAA,CACjD,CAGJ,MAAOqB,IAAuB,CAC1BrB,EAAO,SAAS,cAAc,QAAWlD,GAAM,CAC3CkB,EAAa,OAAS,CAAElB,EAAE,OAA4B,MACtDR,EAAM,UAAU0B,EAAa,OAAS,GAAG,CAAA,CAC7C,CAGJ,MAAOsD,IAAqB,CACxBtB,EAAO,SAAS,WAAW,QAAU,IAAM,CACvChC,EAAa,UAAaA,EAAa,SAAW,GAAK,EAEvDA,EAAa,SAAWA,EAAa,SAErCgC,EAAO,mBAAmBhC,EAAa,QAAQ,EAE/C1B,EAAM,QAAQ0B,EAAa,WAAa,CAAC,CAAA,CAC7C,CAGJ,MAAOuD,IAAwB,CAC3BvB,EAAO,SAAS,cAAc,QAAU,IAAM,CAC1ChC,EAAa,YAAe,EAAIA,EAAa,YAE7CA,EAAa,YAAcA,EAAa,YAExCgC,EAAO,sBAAsBhC,EAAa,WAAW,EAEjDA,EAAa,cAAgB,EAC7Bf,EAAgB,gBAAgB,CAC5B,sBAAuB,EAAA,CAC1B,EAEDA,EAAgB,gBAAA,EAGpBsB,EAAQ,eAAetB,EAAgB,QAAQ,EAC/CsB,EAAQ,mBAAmBtB,EAAgB,iBAAiB,EAC5DsB,EAAQ,SAAStB,EAAgB,iBAAiB,CAAA,CACtD,CAER,CCzFO,MAAMkC,CAAc,CACvB,MAAOF,GAAe,GAEtB,OAAO,MAAO,CACV,GAAI,KAAKA,GAAc,MAAM,IAAI,MAAM,iBAAiB,EAExD,KAAKwC,GAAA,EACL,KAAKC,GAAA,EAEL,KAAKzC,GAAe,EAAA,CAGxB,OAAO,gBAAiB,CACf3C,EAAM,YAEPA,EAAM,aACNA,EAAM,MAAA,EACN0D,EAAO,mBAAmB,EAAK,EAC/BzB,EAAQ,mBAAmB,EAAE,IAE7BjC,EAAM,KAAA,EACN0D,EAAO,mBAAmB,EAAI,EAC9BzB,EAAQ,mBAAmBtB,EAAgB,iBAAiB,GAChE,CAGJ,aAAa,YAAa,CACtB,GAAIX,EAAM,YAAc,GAAK,CACzBA,EAAM,YAAc,EACpB,MAAA,CAGJ,KAAM,CAAE,MAAAsC,EAAO,MAAAW,GAAUtC,EAAgB,iBAAA,EACzC,MAAM,KAAK,YAAY2B,EAAOW,CAAK,EACnChB,EAAQ,SAAStB,EAAgB,iBAAiB,CAAA,CAGtD,aAAa,cAAc,CAAE,OAAA0E,EAAS,EAAA,EAAS,CAAA,EAAI,CAC/C,KAAM,CAAE,MAAA/C,EAAO,MAAAW,GAAUtC,EAAgB,aAAA,EACzC,MAAM,KAAK,YAAY2B,EAAOW,CAAK,EACnCoC,GAAUpD,EAAQ,SAAStB,EAAgB,iBAAiB,CAAA,CAGhE,aAAa,YAAY2B,EAAcW,EAAe,CAClD,MAAMjD,EAAM,KAAKsC,EAAM,KAAMZ,EAAa,WAAa,CAAC,EACxD1B,EAAM,UAAU0B,EAAa,OAAS,GAAG,EACzC1B,EAAM,KAAA,EAEN4E,EAAa,mBAAmB5E,EAAM,KAAM,EAC5C,KAAKsF,GAAiBtF,EAAM,KAAM,EAElC,MAAMuF,EAAWvF,EAAM,YAAA,EAEvB0D,EAAO,gBAAgBpB,CAAK,EAC5BoB,EAAO,mBAAmB,EAAI,EAC9BA,EAAO,iBAAiB6B,CAAQ,EAChC7B,EAAO,mBAAmB6B,CAAQ,EAClCtD,EAAQ,mBAAmBgB,CAAK,EAEhCO,EAAW,kBAAkBlB,CAAK,EAElC3B,EAAgB,kBAAoBsC,EAEpCsB,EAAO,kBAAkBjC,EAAM,KAAK,CAAA,CAGxC,MAAOgD,GAAiB7B,EAAyB,CAC7CA,EAAM,QAAU,IAAM,CAClB,GAAI/B,EAAa,WAAa,EAC1B,KAAK,cAAc,CAAE,OAAQ,EAAA,CAAO,UAE7BA,EAAa,WAAa,EAAG,CAGpC,GAFef,EAAgB,SAAS,OAAS,IAAMA,EAAgB,kBAE3D,CAER+C,EAAO,mBAAmB,EAAK,EAC/BzB,EAAQ,mBAAmB,EAAE,EAC7B,MAAA,CAGJ,KAAK,cAAc,CAAE,OAAQ,EAAA,CAAO,CAAA,CACxC,CACJ,CAGJ,MAAOkD,IAAyB,CAC5B,OAAO,iBAAiB,UAAY3E,GAAM,CAClCA,EAAE,OAAS,UACXA,EAAE,eAAA,EACF,KAAK,eAAA,EACT,CACH,CAAA,CAGL,MAAO4E,IAA0B,CAAA,CAsBrC,CC7HO,MAAMI,CAAa,CACtB,MAAO7C,GAAe,GAEtB,OAAO,MAAO,CACV,GAAI,KAAKA,GAAc,MAAM,IAAI,MAAM,iBAAiB,EAExD,KAAK8C,GAAA,EACL,KAAKC,GAAA,EAEL,KAAK/C,GAAe,EAAA,CAGxB,MAAO8C,IAAa,CAChB,MAAME,EAAO,SAAS,cAA+B,SAAS,EAE9DA,EAAK,SAAY,GAAM,CACnB,EAAE,eAAA,EAEF7D,EAAW,OAAOF,EAAO,OAAO,KAAK,CAAA,CACzC,CAGJ,MAAO8D,IAAc,CACjB9D,EAAO,MAAM,QAAWpB,GAAM,CAC1BA,EAAE,eAAA,EAEFsB,EAAW,OAAO,EAAE,CAAA,CACxB,CAER,CCfA,eAAe8D,GAAgB,CAC3BlC,EAAO,KAAKhC,EAAa,SAAUA,EAAa,YAAaA,EAAa,MAAM,EAChFE,EAAO,KAAA,EACPK,EAAQ,KAAA,EACRY,EAAc,KAAA,EACd2C,EAAa,KAAA,EACbZ,EAAa,KAAA,EACblC,EAAc,KAAA,EACdc,EAAW,KAAA,EAEX,MAAMiB,EAAW,MAAM,MAAM,iBAAiB,EAC9ChD,EAAO,KAAO,OAAO,OAAO,MAAMgD,EAAS,MAAM,EACjD9D,EAAgB,YAAYc,EAAO,KAAMC,EAAa,cAAgB,CAAC,EAGvEI,EAAW,kBAAA,EAEPA,EAAW,gBACX,QAAQ,IAAI,OAAO,EACnBG,EAAQ,SAAS,MAAM,QAAU,SAGrCR,EAAO,gBAAkB,OAAO,OAAO,MAAM8C,EAAO,oBAAoB,EAExEtC,EAAQ,aAAatB,EAAgB,SAAUc,EAAO,eAAe,CACzE,CAEA,SAASoE,GAAgB,CACrB,GAAI,CACAD,EAAA,CAAc,OACTjB,EAAO,CACZ,MAAMA,CAAK,CAAA,CAEnB,CAEI,SAAS,aAAe,WACxBkB,EAAA,EAEA,SAAS,iBAAiB,mBAAoBA,CAAa"}