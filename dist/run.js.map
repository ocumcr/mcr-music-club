{"version":3,"file":"run.js","sources":["../src/Model/Sound.ts","../src/View/Footer.ts","../src/View/Content.ts","../src/View/Navigation.ts","../src/Model/LocalStorage.ts","../src/Model/Record.ts","../src/Controller/ContentEvents.ts","../src/Controller/PlaylistManager.ts","../src/View/Header.ts","../src/Controller/URLManager.ts","../src/Model/Survey.ts","../src/Controller/EventHandlers.ts","../src/Controller/HeaderEvents.ts","../src/Controller/FooterEvents.ts","../src/Controller/NavigationEvents.ts","../src/run.ts"],"sourcesContent":["export class Sound {\r\n    static #isReady = false\r\n\r\n    static audio: HTMLAudioElement | null = null\r\n\r\n    static #source: MediaElementAudioSourceNode\r\n    static #context: AudioContext\r\n    static #gain: GainNode\r\n\r\n    static load(src: string) {\r\n        if (!this.#context) {\r\n            this.#context = new AudioContext()\r\n            this.#gain = this.#context.createGain()\r\n            this.#gain.connect(this.#context.destination)\r\n        }\r\n\r\n        if (this.audio) {\r\n            this.audio.pause()\r\n            this.#source.disconnect()\r\n        }\r\n\r\n        this.audio = new Audio(src)\r\n        this.#source = this.#context.createMediaElementSource(this.audio)\r\n        this.#source.connect(this.#gain)\r\n\r\n        return new Promise<void>((resolve) => {\r\n            this.audio!.onloadedmetadata = (e) => {\r\n                this.#isReady = true\r\n\r\n                resolve()\r\n            }\r\n        })\r\n    }\r\n\r\n    static play() {\r\n        if (!this.isReady()) return\r\n        this.audio.play()\r\n    }\r\n\r\n    static pause() {\r\n        if (!this.isReady()) return\r\n        this.audio.pause()\r\n    }\r\n\r\n    static isPlaying(): boolean {\r\n        return this.isReady() && !this.audio.paused\r\n    }\r\n\r\n    static setLoop(loop: boolean) {\r\n        if (!this.isReady()) return\r\n        this.audio.loop = loop\r\n    }\r\n\r\n    static isReady(): this is typeof Sound & { audio: HTMLAudioElement } {\r\n        return this.#isReady\r\n    }\r\n\r\n    static setVolume(volume: number) {\r\n        if (volume < 0 || 1 < volume) {\r\n            console.error(\"volume must range from 0 to 1.\")\r\n            return\r\n        }\r\n\r\n        this.#gain.gain.value = volume\r\n    }\r\n\r\n    static getDuration(): number {\r\n        return this.isReady() ? this.audio.duration : 0\r\n    }\r\n\r\n    static set currentTime(second: number) {\r\n        if (!this.isReady()) return\r\n        this.audio.currentTime = second\r\n    }\r\n\r\n    static get currentTime(): number {\r\n        return this.isReady() ? this.audio.currentTime : 0\r\n    }\r\n}\r\n","export class Footer {\r\n    static elements: {\r\n        playButton: HTMLElement\r\n        seekBar: HTMLInputElement\r\n        currentTimeText: HTMLElement\r\n        durationText: HTMLElement\r\n        volumeControl: HTMLInputElement\r\n        musicTitle: HTMLElement\r\n        miniThumbnail: HTMLElement\r\n        loopButton: HTMLElement\r\n        shuffleButton: HTMLElement\r\n        backButton: HTMLElement\r\n        forwardButton: HTMLElement\r\n    }\r\n\r\n    static init(loopMode: LoopMode, shuffleMode: ShuffleMode, volume: number) {\r\n        this.elements = {\r\n            playButton: document.getElementById(\"play-button\") as HTMLElement,\r\n            seekBar: document.getElementById(\"seekBar\") as HTMLInputElement,\r\n            currentTimeText: document.getElementById(\"currentTime\") as HTMLElement,\r\n            durationText: document.getElementById(\"duration\") as HTMLElement,\r\n            volumeControl: document.getElementById(\"volume\") as HTMLInputElement,\r\n            musicTitle: document.getElementById(\"music-title\") as HTMLElement,\r\n            miniThumbnail: document.getElementById(\"mini-thumbnail\") as HTMLElement,\r\n            loopButton: document.getElementById(\"loop-button\") as HTMLElement,\r\n            shuffleButton: document.getElementById(\"shuffle-button\") as HTMLElement,\r\n            backButton: document.getElementById(\"back-button\") as HTMLElement,\r\n            forwardButton: document.getElementById(\"forward-button\") as HTMLElement,\r\n        }\r\n\r\n        this.#initializeVolume(volume)\r\n        this.updateLoopButtonUI(loopMode)\r\n        this.updateShuffleButtonUI(shuffleMode)\r\n    }\r\n\r\n    static #initializeVolume(volume: number) {\r\n        this.elements.volumeControl.value = \"\" + volume\r\n    }\r\n\r\n    static updateLoopButtonUI(loopMode: LoopMode) {\r\n        const loopStates = [\"loop-none\", \"\", \"loop-one\"]\r\n        const loopTitles = [\"ループしない\", \"ループする\", \"一曲ループ\"]\r\n\r\n        this.elements.loopButton.dataset[\"loop\"] = loopStates[loopMode]\r\n\r\n        this.elements.loopButton.title = loopTitles[loopMode]\r\n    }\r\n\r\n    static updateShuffleButtonUI(shuffleMode: ShuffleMode) {\r\n        this.elements.shuffleButton.classList.toggle(\"shuffle-off\", shuffleMode === 0)\r\n    }\r\n\r\n    static updatePlayButtonUI(isPlaying: boolean) {\r\n        this.elements.playButton.classList.toggle(\"button-playing\", isPlaying)\r\n    }\r\n\r\n    static updateTrackInfo(track: Track) {\r\n        this.elements.musicTitle.innerHTML = `${track.title}<br />${track.author}`\r\n        this.elements.miniThumbnail.style.backgroundImage = `url(${track.thumbnail})`\r\n        this.elements.miniThumbnail.style.backgroundSize = \"cover\"\r\n    }\r\n\r\n    static updateSeekBarMaxAndDurationText(max: number) {\r\n        this.elements.durationText.innerText = this.#formatTime(max)\r\n        this.elements.seekBar.max = String(max)\r\n    }\r\n\r\n    static updateSeekBarAndCurrentTimeText(time: number) {\r\n        this.elements.currentTimeText.innerText = this.#formatTime(time)\r\n        this.elements.seekBar.value = String(time)\r\n    }\r\n\r\n    static #formatTime(seconds: number) {\r\n        const mins = Math.floor(seconds / 60)\r\n        const secs = Math.floor(seconds % 60)\r\n        return `${String(mins).padStart(2, \"0\")}:${String(secs).padStart(2, \"0\")}`\r\n    }\r\n}\r\n","export class Content {\r\n    static debugLog: HTMLElement\r\n    static content: HTMLElement\r\n    static #musics: HTMLOListElement\r\n\r\n    static init() {\r\n        this.debugLog = document.getElementById(\"debug-log\")!\r\n        this.content = document.querySelector(\".content\")!\r\n        this.#musics = document.getElementById(\"musics\") as HTMLOListElement\r\n    }\r\n\r\n    static displayDebugLog() {\r\n        this.debugLog.style.display = \"block\"\r\n    }\r\n\r\n    static addLog(text: string) {\r\n        console.log(text)\r\n        // document.getElementById(\"debug-log\").innerHTML += navigator.mediaSession.playbackState + \"<br />\"\r\n        this.debugLog.innerHTML += text + \"<br />\"\r\n    }\r\n\r\n    static fadeIn() {\r\n        this.content.classList.remove(\"fade-in\")\r\n        requestAnimationFrame(() => {\r\n            this.content.classList.add(\"fade-in\")\r\n        })\r\n    }\r\n\r\n    static scrollTo(index: number) {\r\n        if (index <= 0) {\r\n            window.scrollTo({\r\n                top: 0,\r\n                behavior: \"smooth\",\r\n            })\r\n        } else {\r\n            const track = document.querySelectorAll(\".track\")[index - 1]\r\n\r\n            track.scrollIntoView({\r\n                behavior: \"smooth\",\r\n            })\r\n        }\r\n    }\r\n\r\n    static renderPlaylist(playlist: readonly Track[], playCountRecord: PlayCountRecord | null) {\r\n        this.#musics.innerHTML = playlist.map(this.#createTrackElement).join(\"\")\r\n\r\n        playCountRecord && this.setPlayCount(playlist, playCountRecord)\r\n    }\r\n\r\n    static #createTrackElement(track: Track) {\r\n        const tags = track.tags.map((tag) => `<button class=\"tag-button\">#${tag}</button>`).join(\"\")\r\n\r\n        return `\r\n            <li class=\"track\" data-state=\"pause\">\r\n                <div class=\"img-box\" style=\"\r\n                    background: url(${track.thumbnail});\r\n                    background-size: cover;\r\n                \">\r\n                    <i class=\"fa-solid fa-circle-play\"></i>\r\n                    <i class=\"fa-solid fa-circle-pause\"></i>\r\n                    <i class=\"fa-solid fa-spinner\"></i>\r\n                </div>\r\n                <div class=\"description\">\r\n                    <h3>${track.title}</h3>\r\n                    <p>${track.year}</p>\r\n                    <p class=\"author\">${track.author}</p>\r\n                    <p>${track.description}</p>\r\n                    <div class=\"tags\">\r\n                        ${tags}\r\n                    </div>\r\n                </div>\r\n                <div class=\"play-count\">取得中...</div>\r\n            </li>\r\n        `\r\n    }\r\n\r\n    static setPlayCount(playlist: readonly Track[], playCountRecord: PlayCountRecord) {\r\n        const list = document.querySelectorAll<HTMLElement>(\".play-count\")\r\n\r\n        playlist.forEach((obj, i) => {\r\n            // まだ再生されたことがないならレコードに載ってない\r\n            const playCount = playCountRecord[obj.title] ?? 0\r\n            list[i].innerText = \"再生回数: \" + playCount\r\n        })\r\n    }\r\n\r\n    static updatePlayingClass(index: number) {\r\n        this.#musics.querySelectorAll<HTMLElement>(\".track\").forEach((track, i) => {\r\n            track.dataset[\"state\"] = i === index ? \"playing\" : \"pause\"\r\n        })\r\n    }\r\n\r\n    static setLoading(index: number) {\r\n        const track = this.#musics.querySelectorAll<HTMLElement>(\".track\")[index]\r\n\r\n        if (track) {\r\n            track.dataset[\"state\"] = \"loading\"\r\n        }\r\n    }\r\n}\r\n","export class Navigation {\r\n    static setPositionState(audio: HTMLAudioElement) {\r\n        if (!(\"mediaSession\" in navigator)) return\r\n\r\n        navigator.mediaSession.setPositionState({\r\n            duration: audio.duration,\r\n            playbackRate: audio.playbackRate,\r\n            position: audio.currentTime,\r\n        })\r\n    }\r\n\r\n    static setNavigationMenu(track: Track) {\r\n        if (!(\"mediaSession\" in navigator)) return\r\n\r\n        navigator.mediaSession.metadata = new MediaMetadata({\r\n            title: track.title ?? \"\",\r\n            artist: track.author ?? \"\",\r\n            artwork: [{ src: track.thumbnail ?? \"\" }],\r\n        })\r\n    }\r\n}\r\n","export class LocalStorage {\r\n    static set volume(volume: number) {\r\n        localStorage.setItem(\"volume\", \"\" + volume)\r\n    }\r\n\r\n    static get volume() {\r\n        return localStorage[\"volume\"] ? Number(localStorage[\"volume\"]) : 50\r\n    }\r\n\r\n    static set loopMode(loopMode: LoopMode) {\r\n        localStorage.setItem(\"loopMode\", \"\" + loopMode)\r\n    }\r\n\r\n    static get loopMode(): LoopMode {\r\n        return (localStorage[\"loopMode\"] ? Number(localStorage[\"loopMode\"]) : 0) as LoopMode\r\n    }\r\n\r\n    static set shuffleMode(loopMode: ShuffleMode) {\r\n        localStorage.setItem(\"shuffleMode\", \"\" + loopMode)\r\n    }\r\n\r\n    static get shuffleMode(): ShuffleMode {\r\n        return (localStorage[\"shuffleMode\"] ? Number(localStorage[\"shuffleMode\"]) : 0) as ShuffleMode\r\n    }\r\n}\r\n","// グローバル状態の管理\r\nexport class Record {\r\n    static data: Readonly<Track[]> = []\r\n    static playCountRecord: PlayCountRecord | null = null\r\n}\r\n","import { PlaylistManager } from \"./PlaylistManager.js\"\r\nimport { URLManager } from \"./URLManager.js\"\r\nimport { EventHandlers } from \"./EventHandlers.js\"\r\n\r\nimport { Content } from \"../View/Content.js\"\r\n\r\nexport class ContentEvents {\r\n    static #initialized = false\r\n\r\n    static init() {\r\n        if (this.#initialized) throw new Error(\"すでにinitialized!\")\r\n\r\n        if (URLManager.isDebugMode()) {\r\n            console.log(\"開けゴマ!\")\r\n            Content.displayDebugLog()\r\n        }\r\n\r\n        this.#initialized = true\r\n    }\r\n\r\n    // playlistが変更されたら、描画とともにイベントも更新すべき\r\n    static setupTrackClickEvents() {\r\n        const playlist = PlaylistManager.getPlaylist()\r\n\r\n        document.querySelectorAll(\".track\").forEach((track, i) => {\r\n            // アイコン\r\n            track.querySelector<HTMLDivElement>(\".img-box\")!.onclick = () => {\r\n                if (PlaylistManager.getPlayingTrackIndex() === i) {\r\n                    // 現在のトラックがクリックされた場合は再生/一時停止を切り替える\r\n                    EventHandlers.togglePlayback()\r\n                } else {\r\n                    // 別のトラックがクリックされた場合はそのトラックを再生する\r\n                    EventHandlers.changeTrack(playlist[i])\r\n                }\r\n            }\r\n\r\n            // 作者\r\n            track.querySelector<HTMLParagraphElement>(\".author\")!.onclick = () => {\r\n                URLManager.search(playlist[i].author)\r\n            }\r\n\r\n            // タグ\r\n            track.querySelectorAll<HTMLButtonElement>(\".tag-button\").forEach((button, j) => {\r\n                button.onclick = () => {\r\n                    URLManager.search(playlist[i].tags[j])\r\n                }\r\n            })\r\n        })\r\n    }\r\n}\r\n","import { Record } from \"../Model/Record.js\"\r\nimport { Sound } from \"../Model/Sound.js\"\r\nimport { Content } from \"../View/Content.js\"\r\nimport { ContentEvents } from \"./ContentEvents.js\"\r\n\r\n// プレイリスト管理のクラス\r\nexport class PlaylistManager {\r\n    static #playlist: Readonly<Track[]> = []\r\n    static #defaultOrderPlaylist: Readonly<Track[]> = []\r\n\r\n    static playingTrackTitle: string = \"\"\r\n\r\n    static getPlayingTrackIndex(): number {\r\n        return this.#playlist.findIndex((track) => track.title === this.playingTrackTitle)\r\n    }\r\n\r\n    static hasPlayingTrack() {\r\n        return this.getPlayingTrackIndex() !== -1\r\n    }\r\n\r\n    static setPlaylist(playlist: readonly Track[], shuffle: boolean) {\r\n        this.#defaultOrderPlaylist = playlist\r\n        this.#playlist = shuffle ? this.#shuffleArray([...playlist]) : playlist\r\n        this.#onChangePlaylist()\r\n    }\r\n\r\n    static getPlaylist() {\r\n        return this.#playlist\r\n    }\r\n\r\n    static setDefaultOrder() {\r\n        this.#playlist = [...this.#defaultOrderPlaylist]\r\n        this.#onChangePlaylist()\r\n    }\r\n\r\n    static shufflePlaylist({ moveCurrentTrackToTop }: { moveCurrentTrackToTop: boolean }) {\r\n        if (this.hasPlayingTrack()) {\r\n            const currentTrack = this.#playlist[this.getPlayingTrackIndex()]\r\n\r\n            // 今再生しているトラックを一番目に持ってくる\r\n            do {\r\n                this.#playlist = this.#shuffleArray([...this.#playlist])\r\n            } while (moveCurrentTrackToTop && this.#playlist[0] != currentTrack)\r\n        } else {\r\n            this.#playlist = this.#shuffleArray([...this.#playlist])\r\n        }\r\n\r\n        this.#onChangePlaylist()\r\n    }\r\n\r\n    static getNextTrack() {\r\n        if (!this.hasPlayingTrack()) return { track: this.#playlist[0] }\r\n        const nextIndex = (this.getPlayingTrackIndex() + 1) % this.#playlist.length\r\n        return { track: this.#playlist[nextIndex] }\r\n    }\r\n\r\n    static getPreviousTrack() {\r\n        if (!this.hasPlayingTrack()) return { track: this.#playlist[0] }\r\n        const prevIndex = (this.getPlayingTrackIndex() - 1 + this.#playlist.length) % this.#playlist.length\r\n        return { track: this.#playlist[prevIndex] }\r\n    }\r\n\r\n    static #shuffleArray(array: any[]) {\r\n        if (array.length == 1) return [...array]\r\n\r\n        return [...array].reduce((_, cur, idx, arr) => {\r\n            const rand = Math.floor(Math.random() * (idx + 1))\r\n            ;[arr[idx], arr[rand]] = [arr[rand], cur]\r\n            return arr\r\n        })\r\n    }\r\n\r\n    static #onChangePlaylist() {\r\n        // やらなくちゃいけない\r\n        Content.renderPlaylist(this.#playlist, Record.playCountRecord)\r\n        ContentEvents.setupTrackClickEvents()\r\n\r\n        if (Sound.isPlaying()) {\r\n            // 最悪やらなくていい\r\n            Content.updatePlayingClass(this.getPlayingTrackIndex())\r\n        }\r\n    }\r\n}\r\n","export class Header {\r\n    static title: HTMLElement\r\n    static searchBox: HTMLInputElement\r\n    static searchForm: HTMLFormElement\r\n\r\n    static init() {\r\n        this.title = document.getElementById(\"title\")!\r\n        this.searchBox = document.getElementById(\"search-box\") as HTMLInputElement\r\n        this.searchForm = document.getElementById(\"search\") as HTMLFormElement\r\n    }\r\n\r\n    static setSearchBox(text: string) {\r\n        this.searchBox.value = text\r\n    }\r\n}\r\n","import { Record } from \"../Model/Record.js\"\r\nimport { LocalStorage } from \"../Model/LocalStorage.js\"\r\nimport { PlaylistManager } from \"./PlaylistManager.js\"\r\nimport { Content } from \"../View/Content.js\"\r\nimport { Header } from \"../View/Header.js\"\r\n\r\nexport class URLManager {\r\n    static isDebugMode(): boolean {\r\n        const url = new URL(window.location.href)\r\n        return url.searchParams.get(\"debug\") === \"true\"\r\n    }\r\n\r\n    static search(text: string) {\r\n        if (text === \"\") {\r\n            this.#clearSearchQuery()\r\n        } else {\r\n            this.#setSearchQuery(text)\r\n        }\r\n\r\n        this.handleQueryChange()\r\n    }\r\n\r\n    static handleQueryChange() {\r\n        console.log(\"クエリパラメータが変更されました\")\r\n\r\n        this.#setPlaylist()\r\n        Content.fadeIn()\r\n    }\r\n\r\n    static #setPlaylist() {\r\n        const search = this.#getSearchQuery()\r\n\r\n        let playlist = Record.data\r\n        if (search !== \"\") {\r\n            playlist = Record.data.filter(\r\n                (track) => track.tags.includes(search) || track.title.includes(search) || track.author === search,\r\n            )\r\n        }\r\n\r\n        Header.setSearchBox(search)\r\n\r\n        PlaylistManager.setPlaylist(playlist, LocalStorage.shuffleMode === 1)\r\n    }\r\n\r\n    static #getSearchQuery(): string {\r\n        const url = new URL(window.location.href)\r\n        return url.searchParams.get(\"search\") ?? \"\"\r\n    }\r\n\r\n    static #setSearchQuery(query: string) {\r\n        const url = new URL(window.location.href)\r\n        url.searchParams.set(\"search\", query)\r\n        window.history.pushState({}, \"\", url)\r\n    }\r\n\r\n    static #clearSearchQuery() {\r\n        const url = new URL(window.location.href)\r\n        url.searchParams.delete(\"search\")\r\n        window.history.pushState({}, \"\", url)\r\n    }\r\n}\r\n\r\n// 履歴変更検知用のイベントリスナー\r\nwindow.addEventListener(\"popstate\", (event) => {\r\n    event.preventDefault() // ページ遷移をキャンセル\r\n\r\n    URLManager.handleQueryChange() // 関数実行\r\n\r\n    console.log(\"popped\")\r\n})\r\n","import { URLManager } from \"../Controller/URLManager.js\"\r\n\r\nlet playCounted = false\r\n\r\nexport class Survey {\r\n    static safeSendPlayCount(title: string) {\r\n        if (!playCounted && !URLManager.isDebugMode()) {\r\n            this.#sendPlayCount(title)\r\n\r\n            playCounted = true\r\n\r\n            setTimeout(() => {\r\n                playCounted = false\r\n            }, 1000)\r\n        }\r\n    }\r\n\r\n    static async fetchPlayCountRecord() {\r\n        const response = await fetch(\r\n            \"https://script.google.com/macros/s/AKfycbw-M6WdDND050H_DboJKixnDERBEYu1X24O6JthlZkohDJMKfrELuQ5YHDpbZ8N3eOh/exec\",\r\n        ) // WebアプリURLを指定\r\n\r\n        const data = await response.json() // JSONデータとして解析\r\n\r\n        return data\r\n    }\r\n\r\n    static async #sendPlayCount(title: string) {\r\n        try {\r\n            const response = await fetch(\r\n                \"https://script.google.com/macros/s/AKfycbya_x47m1TS70IhvejTmlMscmsGtheak2MvwYuXvVMse-Ar6UDv1EqmG_aQTSmDxRWc/exec\",\r\n                {\r\n                    method: \"POST\",\r\n                    headers: { \"Content-Type\": \"application/json\" },\r\n                    body: JSON.stringify({\r\n                        title: title,\r\n                    }),\r\n                    mode: \"no-cors\",\r\n                },\r\n            )\r\n\r\n            // console.log(response)\r\n\r\n            if (!response.ok) {\r\n                throw new Error(`HTTP error! status: ${response.status}`)\r\n            }\r\n\r\n            const result = await response.json()\r\n            console.log(result.status === \"success\" ? \"送信完了！\" : \"エラーが発生しました。\")\r\n        } catch (error) {\r\n            console.error(\"Error:\", error)\r\n            console.log(\"送信中にエラーが発生しました。\")\r\n        }\r\n    }\r\n}\r\n","import { Sound } from \"../Model/Sound.js\"\r\n\r\nimport { Footer } from \"../View/Footer.js\"\r\nimport { Content } from \"../View/Content.js\"\r\nimport { Navigation } from \"../View/Navigation.js\"\r\n\r\nimport { LocalStorage } from \"../Model/LocalStorage.js\"\r\nimport { Survey } from \"../Model/Survey.js\"\r\nimport { PlaylistManager } from \"./PlaylistManager.js\"\r\n\r\n// イベントハンドラの設定\r\nexport class EventHandlers {\r\n    static #initialized = false\r\n\r\n    static init() {\r\n        if (this.#initialized) throw new Error(\"すでにinitialized!\")\r\n\r\n        this.#setupKeyboardControls()\r\n        this.#setupVisibilityHandler()\r\n\r\n        this.#initialized = true\r\n    }\r\n\r\n    static togglePlayback() {\r\n        if (!Sound.isReady()) return\r\n\r\n        if (Sound.isPlaying()) {\r\n            Sound.pause()\r\n            Footer.updatePlayButtonUI(false)\r\n            Content.updatePlayingClass(-1)\r\n        } else {\r\n            Sound.play()\r\n            Footer.updatePlayButtonUI(true)\r\n            Content.updatePlayingClass(PlaylistManager.getPlayingTrackIndex())\r\n        }\r\n    }\r\n\r\n    static async handleBack() {\r\n        if (Sound.currentTime > 0.5) {\r\n            Sound.currentTime = 0\r\n            return\r\n        }\r\n\r\n        const { track } = PlaylistManager.getPreviousTrack()\r\n        await this.changeTrack(track)\r\n        Content.scrollTo(PlaylistManager.getPlayingTrackIndex())\r\n    }\r\n\r\n    static async handleForward({ scroll = true } = {}) {\r\n        const { track } = PlaylistManager.getNextTrack()\r\n        await this.changeTrack(track)\r\n        scroll && Content.scrollTo(PlaylistManager.getPlayingTrackIndex())\r\n    }\r\n\r\n    static async changeTrack(track: Track) {\r\n        PlaylistManager.playingTrackTitle = track.title\r\n        if (!PlaylistManager.hasPlayingTrack())\r\n            throw new Error(\"謎の方法でplaylistに存在しない曲を選択しようとしているにゃ！\")\r\n\r\n        const index = PlaylistManager.getPlayingTrackIndex()\r\n\r\n        // 選択したトラックをローディング状態にする\r\n        Content.updatePlayingClass(index)\r\n        Content.setLoading(index)\r\n\r\n        // 読み込んで再生\r\n        await Sound.load(track.path)\r\n        Sound.setVolume(LocalStorage.volume / 100)\r\n        Sound.setLoop(LocalStorage.loopMode === 2)\r\n        Sound.play()\r\n\r\n        // 表示を更新\r\n        Footer.updateTrackInfo(track)\r\n        Footer.updatePlayButtonUI(true)\r\n        Footer.updateSeekBarMaxAndDurationText(Sound.getDuration())\r\n        Content.updatePlayingClass(index)\r\n        Navigation.setNavigationMenu(track)\r\n\r\n        //\r\n        this.#setupSeekBarUpdate(Sound.audio!)\r\n        this.#setupTrackEnded(Sound.audio!)\r\n\r\n        // 再生回数を更新\r\n        Survey.safeSendPlayCount(track.title)\r\n    }\r\n\r\n    static #setupSeekBarUpdate(audio: HTMLAudioElement) {\r\n        // 再生中にシークバーを更新\r\n        audio.ontimeupdate = () => {\r\n            Footer.updateSeekBarAndCurrentTimeText(audio.currentTime)\r\n            Navigation.setPositionState(audio)\r\n\r\n            // ループ再生を検知\r\n            if (LocalStorage.loopMode == 2 && audio.duration - audio.currentTime < 0.65) {\r\n                const title = PlaylistManager.playingTrackTitle\r\n                title && Survey.safeSendPlayCount(title)\r\n            }\r\n        }\r\n    }\r\n\r\n    static #setupTrackEnded(audio: HTMLAudioElement) {\r\n        audio.onended = () => {\r\n            const isLast = PlaylistManager.getPlaylist().length - 1 === PlaylistManager.getPlayingTrackIndex()\r\n\r\n            if (LocalStorage.loopMode === 1) {\r\n                if (isLast) {\r\n                    PlaylistManager.shufflePlaylist({ moveCurrentTrackToTop: false })\r\n                    this.changeTrack(PlaylistManager.getPlaylist()[0])\r\n                    Content.scrollTo(-1)\r\n                    return\r\n                }\r\n\r\n                this.handleForward({ scroll: false })\r\n\r\n                //\r\n            } else if (LocalStorage.loopMode === 0) {\r\n                if (isLast) {\r\n                    // 止める\r\n                    Footer.updatePlayButtonUI(false)\r\n                    Content.updatePlayingClass(-1)\r\n                    return\r\n                }\r\n\r\n                // 勝手に終わった時にスクロールするのは嫌でしょう？\r\n                this.handleForward({ scroll: false })\r\n            }\r\n        }\r\n    }\r\n\r\n    static #setupKeyboardControls() {\r\n        window.addEventListener(\"keydown\", (e) => {\r\n            if (e.code === \"Space\") {\r\n                e.preventDefault()\r\n                this.togglePlayback()\r\n            }\r\n        })\r\n    }\r\n\r\n    static #setupVisibilityHandler() {\r\n        // document.addEventListener(\"visibilitychange\", async (e) => {\r\n        //     addLog(\"visibility changed: \" + document.visibilityState)\r\n        //     addLog(\"OS: \" + getMobileOS())\r\n        //     if (getMobileOS() != \"iOS\") return\r\n        //     if (document.visibilityState === \"visible\") {\r\n        //         if (PlayerState.wasPlaying) {\r\n        //             PlayerState.audio.play()\r\n        //         }\r\n        //         const interval = setInterval(() => {\r\n        //             addLog(PlayerState.audio.playbackRate)\r\n        //         }, 1000 / 24)\r\n        //         setTimeout(() => {\r\n        //             clearInterval(interval)\r\n        //         }, 10000)\r\n        //     } else {\r\n        //         // ページから離れる時の処理\r\n        //         PlayerState.wasPlaying = !PlayerState.audio.paused\r\n        //         PlayerState.audio.pause()\r\n        //     }\r\n        // })\r\n    }\r\n}\r\n","import { Header } from \"../View/Header.js\"\r\nimport { URLManager } from \"./URLManager.js\"\r\n\r\nexport class HeaderEvents {\r\n    static #initialized = false\r\n\r\n    static init() {\r\n        if (this.#initialized) throw new Error(\"すでにinitialized!\")\r\n\r\n        this.#setupForm()\r\n        this.#setupTitle()\r\n\r\n        this.#initialized = true\r\n    }\r\n\r\n    static #setupForm() {\r\n        Header.searchForm.onsubmit = (e) => {\r\n            e.preventDefault()\r\n\r\n            URLManager.search(Header.searchBox.value)\r\n        }\r\n    }\r\n\r\n    static #setupTitle() {\r\n        Header.title.onclick = (e) => {\r\n            e.preventDefault()\r\n\r\n            URLManager.search(\"\")\r\n        }\r\n    }\r\n}\r\n","import { LocalStorage } from \"../Model/LocalStorage.js\"\r\nimport { PlaylistManager } from \"./PlaylistManager.js\"\r\nimport { Sound } from \"../Model/Sound.js\"\r\n\r\nimport { Content } from \"../View/Content.js\"\r\nimport { Footer } from \"../View/Footer.js\"\r\n\r\nimport { EventHandlers } from \"./EventHandlers.js\"\r\n\r\nexport class FooterEvents {\r\n    static #initialized = false\r\n\r\n    static init() {\r\n        if (this.#initialized) throw new Error(\"すでにinitialized!\")\r\n\r\n        this.#setupPlaybackControls()\r\n        this.#setupSeekBarControls()\r\n        this.#setupVolumeControls()\r\n        this.#setupLoopControls()\r\n        this.#setupShuffleControls()\r\n        this.#setupMiniThumbnail()\r\n\r\n        this.#initialized = true\r\n    }\r\n\r\n    static #setupMiniThumbnail() {\r\n        Footer.elements.musicTitle.addEventListener(\"click\", () => {\r\n            Content.scrollTo(PlaylistManager.getPlayingTrackIndex())\r\n        })\r\n    }\r\n\r\n    static #setupPlaybackControls() {\r\n        Footer.elements.playButton.onclick = () => EventHandlers.togglePlayback()\r\n        Footer.elements.backButton.onclick = () => EventHandlers.handleBack()\r\n        Footer.elements.forwardButton.onclick = () => EventHandlers.handleForward()\r\n    }\r\n\r\n    static #setupSeekBarControls() {\r\n        Footer.elements.seekBar.oninput = () => {\r\n            Sound.currentTime = +Footer.elements.seekBar.value\r\n        }\r\n    }\r\n\r\n    static #setupVolumeControls() {\r\n        Footer.elements.volumeControl.oninput = (e) => {\r\n            LocalStorage.volume = +(e.target as HTMLInputElement).value\r\n            Sound.setVolume(LocalStorage.volume / 100)\r\n        }\r\n    }\r\n\r\n    static #setupLoopControls() {\r\n        Footer.elements.loopButton.onclick = () => {\r\n            LocalStorage.loopMode = ((LocalStorage.loopMode + 1) % 3) as LoopMode\r\n\r\n            Footer.updateLoopButtonUI(LocalStorage.loopMode)\r\n\r\n            Sound.setLoop(LocalStorage.loopMode === 2)\r\n        }\r\n    }\r\n\r\n    static #setupShuffleControls() {\r\n        Footer.elements.shuffleButton.onclick = () => {\r\n            LocalStorage.shuffleMode = (1 - LocalStorage.shuffleMode) as ShuffleMode\r\n\r\n            if (LocalStorage.shuffleMode === 1) {\r\n                PlaylistManager.shufflePlaylist({\r\n                    moveCurrentTrackToTop: true,\r\n                })\r\n            } else {\r\n                PlaylistManager.setDefaultOrder()\r\n            }\r\n\r\n            Footer.updateShuffleButtonUI(LocalStorage.shuffleMode)\r\n\r\n            Content.scrollTo(PlaylistManager.getPlayingTrackIndex())\r\n        }\r\n    }\r\n}\r\n","import { EventHandlers } from \"./EventHandlers.js\"\r\nimport { Sound } from \"../Model/Sound.js\"\r\nimport { Content } from \"../View/Content.js\"\r\n\r\nexport class NavigationEvents {\r\n    static init() {\r\n        if (!(\"mediaSession\" in navigator)) return\r\n\r\n        // 再生コントロール対応\r\n        this.#set(\"play\", (e) => {\r\n            Content.addLog(e.action)\r\n            navigator.mediaSession.playbackState = \"playing\"\r\n            EventHandlers.togglePlayback()\r\n        })\r\n\r\n        this.#set(\"pause\", (e) => {\r\n            Content.addLog(e.action)\r\n            navigator.mediaSession.playbackState = \"paused\"\r\n            EventHandlers.togglePlayback()\r\n        })\r\n\r\n        this.#set(\"nexttrack\", (e) => {\r\n            Content.addLog(e.action)\r\n            EventHandlers.handleForward()\r\n        })\r\n\r\n        this.#set(\"previoustrack\", (e) => {\r\n            Content.addLog(e.action)\r\n            EventHandlers.handleBack()\r\n        })\r\n\r\n        this.#set(\"seekto\", (e) => {\r\n            Content.addLog(e.action + \": \" + e.seekTime)\r\n\r\n            Sound.currentTime = +e.seekTime!\r\n        })\r\n\r\n        this.#set(\"seekbackward\", (e) => {\r\n            Content.addLog(e.action + \": \" + e.seekOffset)\r\n\r\n            Sound.currentTime -= +e.seekOffset!\r\n        })\r\n\r\n        this.#set(\"seekforward\", (e) => {\r\n            Content.addLog(e.action + \": \" + e.seekOffset)\r\n\r\n            Sound.currentTime += +e.seekOffset!\r\n        })\r\n    }\r\n\r\n    static #set(action: MediaSessionAction, handler: MediaSessionActionHandler) {\r\n        navigator.mediaSession.setActionHandler(action, handler)\r\n    }\r\n}\r\n","import { EventHandlers } from \"./Controller/EventHandlers.js\"\r\nimport { ContentEvents } from \"./Controller/ContentEvents.js\"\r\nimport { HeaderEvents } from \"./Controller/HeaderEvents.js\"\r\nimport { FooterEvents } from \"./Controller/FooterEvents.js\"\r\nimport { NavigationEvents } from \"./Controller/NavigationEvents.js\"\r\nimport { URLManager } from \"./Controller/URLManager.js\"\r\n\r\nimport { Record } from \"./Model/Record.js\"\r\nimport { Survey } from \"./Model/Survey.js\"\r\nimport { PlaylistManager } from \"./Controller/PlaylistManager.js\"\r\nimport { LocalStorage } from \"./Model/LocalStorage.js\"\r\n\r\nimport { Content } from \"./View/Content.js\"\r\nimport { Footer } from \"./View/Footer.js\"\r\nimport { Header } from \"./View/Header.js\"\r\n\r\n// アプリケーションの初期化\r\nasync function initializeApp() {\r\n    Footer.init(LocalStorage.loopMode, LocalStorage.shuffleMode, LocalStorage.volume)\r\n    Header.init()\r\n    Content.init()\r\n    EventHandlers.init()\r\n    HeaderEvents.init()\r\n    FooterEvents.init()\r\n    ContentEvents.init()\r\n    NavigationEvents.init()\r\n\r\n    const response = await fetch(\"music-data.json\")\r\n    Record.data = Object.freeze(await response.json())\r\n\r\n    // 初期ロード時のクエリ処理\r\n    URLManager.handleQueryChange()\r\n\r\n    // 読み込みに時間がかかるため後回し\r\n    Record.playCountRecord = Object.freeze(await Survey.fetchPlayCountRecord())\r\n    Content.setPlayCount(PlaylistManager.getPlaylist(), Record.playCountRecord!)\r\n}\r\n\r\nfunction tryInitialize() {\r\n    try {\r\n        initializeApp()\r\n    } catch (error) {\r\n        alert(error)\r\n    }\r\n}\r\n\r\nif (document.readyState === \"complete\") {\r\n    tryInitialize()\r\n} else {\r\n    document.addEventListener(\"DOMContentLoaded\", tryInitialize)\r\n}\r\n"],"names":["Sound","#isReady","#source","#context","#gain","src","resolve","e","loop","volume","second","Footer","loopMode","shuffleMode","#initializeVolume","loopStates","loopTitles","isPlaying","track","max","#formatTime","time","seconds","mins","secs","Content","#musics","text","index","playlist","playCountRecord","#createTrackElement","tags","tag","list","obj","i","playCount","Navigation","audio","LocalStorage","Record","ContentEvents","#initialized","URLManager","PlaylistManager","EventHandlers","button","j","#playlist","#defaultOrderPlaylist","shuffle","#shuffleArray","#onChangePlaylist","moveCurrentTrackToTop","currentTrack","nextIndex","prevIndex","array","_","cur","idx","arr","rand","Header","#clearSearchQuery","#setSearchQuery","#setPlaylist","search","#getSearchQuery","query","url","event","playCounted","Survey","title","#sendPlayCount","response","result","error","#setupKeyboardControls","#setupVisibilityHandler","scroll","#setupSeekBarUpdate","#setupTrackEnded","isLast","HeaderEvents","#setupForm","#setupTitle","FooterEvents","#setupPlaybackControls","#setupSeekBarControls","#setupVolumeControls","#setupLoopControls","#setupShuffleControls","#setupMiniThumbnail","NavigationEvents","#set","action","handler","initializeApp","tryInitialize"],"mappings":"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"}